<!DOCTYPE html>
<html  lang="zh">
<head>
    <meta charset="utf-8">
<title>《利用Python进行数据分析·第2版》第8章 数据规整：聚合、合并和重塑 - Lanhoo&#39;s blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />



    <meta name="description" content="转载自简书 第1章 准备工作 第2章 Python语法基础，IPython和Jupyter Notebooks 第3章 Python的数据结构、函数和文件 第4章 NumPy基础：数组和矢量计算 第5章 pandas入门 第6章 数据加载、存储与文件格式 第7章 数据清洗和准备第8章 数据规整：聚合、合并和重塑 第9章 绘图和可视化 第10章 数据聚合与分组运算 第11章 时间序列 第12章 pa">
<meta name="keywords" content="数据分析,pandas,python">
<meta property="og:type" content="article">
<meta property="og:title" content="《利用Python进行数据分析·第2版》第8章 数据规整：聚合、合并和重塑">
<meta property="og:url" content="https:&#x2F;&#x2F;glanhoo.coding.me&#x2F;2019&#x2F;11&#x2F;05&#x2F;%E3%80%8A%E5%88%A9%E7%94%A8Python%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%C2%B7%E7%AC%AC2%E7%89%88%E3%80%8B%E7%AC%AC8%E7%AB%A0%20%E6%95%B0%E6%8D%AE%E8%A7%84%E6%95%B4%EF%BC%9A%E8%81%9A%E5%90%88%E3%80%81%E5%90%88%E5%B9%B6%E5%92%8C%E9%87%8D%E5%A1%91&#x2F;index.html">
<meta property="og:site_name" content="Lanhoo&#39;s blog">
<meta property="og:description" content="转载自简书 第1章 准备工作 第2章 Python语法基础，IPython和Jupyter Notebooks 第3章 Python的数据结构、函数和文件 第4章 NumPy基础：数组和矢量计算 第5章 pandas入门 第6章 数据加载、存储与文件格式 第7章 数据清洗和准备第8章 数据规整：聚合、合并和重塑 第9章 绘图和可视化 第10章 数据聚合与分组运算 第11章 时间序列 第12章 pa">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https:&#x2F;&#x2F;glanhoo.coding.me&#x2F;images&#x2F;og_image.png">
<meta property="og:updated_time" content="2019-12-11T02:20:57.106Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;glanhoo.coding.me&#x2F;images&#x2F;og_image.png">







<link rel="icon" href="/images/grid32.ico">


<!-- 添加用户的样式，用来修改表格样式 -->
<!-- 效果不好，代码块也是表格，把代码块也变了 -->
<link rel="stylesheet" href="/css/user2.css" media="screen" type="text/css">

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-146455672-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-146455672-1');
</script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-154463679-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-154463679-1');
</script>


    
    
<script>
var _hmt = _hmt || [];
(function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?98b898946b9cfb37b87a64ed209f07db";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
})();
</script>

    
    

    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    

    
    
    


<link rel="stylesheet" href="/css/style.css">
<link rel="alternate" href="/atom.xml" title="Lanhoo's blog" type="application/atom+xml">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/grid.svg" alt="《利用Python进行数据分析·第2版》第8章 数据规整：聚合、合并和重塑" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">主页</a>
                
                <a class="navbar-item"
                href="/archives">归档</a>
                
                <a class="navbar-item"
                href="/categories">分类</a>
                
                <a class="navbar-item"
                href="/tags">标签</a>
                
                <a class="navbar-item"
                href="/about">关于</a>
                
            </div>
            
            <div class="navbar-end">
                
                
                <a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;" target="_blank" rel="noopener">
                    <i class="fas fa-list-ul"></i>
                </a>
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;" target="_blank" rel="noopener">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <!-- 将main_column_class() 改为 col() -->
                <div class="column is-6-tablet is-6-desktop is-9-widescreen has-order-2 column-main"><div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">

                

                <time class="level-item has-text-grey" datetime="2019-11-05T01:57:21.000Z">2019-11-05</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/">数据分析</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    1 小时 读完 (大约 6929 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                《利用Python进行数据分析·第2版》第8章 数据规整：聚合、合并和重塑
            
        </h1>
        <div class="content">
            <p>转载自<a href="https://www.jianshu.com/p/cfc035bae567" target="_blank" rel="noopener">简书</a></p>
<p><a href="../《利用Python进行数据分析·第2版》第1章%20准备工作">第1章 准备工作</a><br> <a href="../《利用Python进行数据分析·第2版》第2章%20Python语法基础，IPython和Jupyter%20Notebooks">第2章 Python语法基础，IPython和Jupyter Notebooks</a><br> <a href="../《利用Python进行数据分析·第2版》第3章%20Python的数据结构、函数和文件">第3章 Python的数据结构、函数和文件</a><br> <a href="../《利用Python进行数据分析·第2版》第4章%20NumPy基础：数组和矢量计算">第4章 NumPy基础：数组和矢量计算</a><br> <a href="../《利用Python进行数据分析·第2版》第5章%20pandas入门">第5章 pandas入门</a><br> <a href="../《利用Python进行数据分析·第2版》第6章%20数据加载、存储与文件格式">第6章 数据加载、存储与文件格式</a><br> <a href="../《利用Python进行数据分析·第2版》第7章%20数据清洗和准备">第7章 数据清洗和准备</a><br>第8章 数据规整：聚合、合并和重塑<br> <a href="../《利用Python进行数据分析·第2版》第9章%20绘图和可视化">第9章 绘图和可视化</a><br> <a href="../《利用Python进行数据分析·第2版》第10章%20数据聚合与分组运算">第10章 数据聚合与分组运算</a><br> <a href="../《利用Python进行数据分析·第2版》第11章%20时间序列">第11章 时间序列</a><br> <a href="../《利用Python进行数据分析·第2版》第12章%20pandas高级应用">第12章 pandas高级应用</a><br> <a href="../《利用Python进行数据分析·第2版》第13章%20Python建模库介绍">第13章 Python建模库介绍</a><br> <a href="../《利用Python进行数据分析·第2版》第14章%20数据分析案例">第14章 数据分析案例</a><br> <a href="../《利用Python进行数据分析·第2版》附录A%20NumPy高级应用">附录A NumPy高级应用</a><br> <a href="../《利用Python进行数据分析·第2版》附录B%20更多关于IPython的内容（完）">附录B 更多关于IPython的内容（完）</a>      </p>
<a id="more"></a>

<hr>
<p>在许多应用中，数据可能分散在许多文件或数据库中，存储的形式也不利于分析。本章关注可以聚合、合并、重塑数据的方法。</p>
<p>首先，我会介绍pandas的层次化索引，它广泛用于以上操作。然后，我深入介绍了一些特殊的数据操作。在第14章，你可以看到这些工具的多种应用。</p>
<h1 id="8-1-层次化索引"><a href="#8-1-层次化索引" class="headerlink" title="8.1 层次化索引"></a>8.1 层次化索引</h1><p>层次化索引（hierarchical indexing）是pandas的一项重要功能，它使你能在一个轴上拥有多个（两个以上）索引级别。抽象点说，它使你能以低维度形式处理高维度数据。我们先来看一个简单的例子：创建一个Series，并用一个由列表或数组组成的列表作为索引：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">9</span>]: data = pd.Series(np.random.randn(<span class="hljs-number">9</span>),</span><br><span class="line">   ...:                  index=[[<span class="hljs-string">'a'</span>, <span class="hljs-string">'a'</span>, <span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>, <span class="hljs-string">'c'</span>, <span class="hljs-string">'d'</span>, <span class="hljs-string">'d'</span>],</span><br><span class="line">   ...:                         [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]])</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">10</span>]: data</span><br><span class="line">Out[<span class="hljs-number">10</span>]: </span><br><span class="line">a  <span class="hljs-number">1</span>   <span class="hljs-number">-0.204708</span></span><br><span class="line">   <span class="hljs-number">2</span>    <span class="hljs-number">0.478943</span></span><br><span class="line">   <span class="hljs-number">3</span>   <span class="hljs-number">-0.519439</span></span><br><span class="line">b  <span class="hljs-number">1</span>   <span class="hljs-number">-0.555730</span></span><br><span class="line">   <span class="hljs-number">3</span>    <span class="hljs-number">1.965781</span></span><br><span class="line">c  <span class="hljs-number">1</span>    <span class="hljs-number">1.393406</span></span><br><span class="line">   <span class="hljs-number">2</span>    <span class="hljs-number">0.092908</span></span><br><span class="line">d  <span class="hljs-number">2</span>    <span class="hljs-number">0.281746</span></span><br><span class="line">   <span class="hljs-number">3</span>    <span class="hljs-number">0.769023</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>

<p>看到的结果是经过美化的带有MultiIndex索引的Series的格式。索引之间的“间隔”表示“直接使用上面的标签”：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">11</span>]: data.index</span><br><span class="line">Out[<span class="hljs-number">11</span>]: </span><br><span class="line">MultiIndex(levels=[[<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>, <span class="hljs-string">'d'</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]],</span><br><span class="line">           labels=[[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>], [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>]])</span><br></pre></td></tr></table></figure>

<p>对于一个层次化索引的对象，可以使用所谓的部分索引，使用它选取数据子集的操作更简单：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">12</span>]: data[<span class="hljs-string">'b'</span>]</span><br><span class="line">Out[<span class="hljs-number">12</span>]: </span><br><span class="line"><span class="hljs-number">1</span>   <span class="hljs-number">-0.555730</span></span><br><span class="line"><span class="hljs-number">3</span>    <span class="hljs-number">1.965781</span></span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">13</span>]: data[<span class="hljs-string">'b'</span>:<span class="hljs-string">'c'</span>]</span><br><span class="line">Out[<span class="hljs-number">13</span>]: </span><br><span class="line">b  <span class="hljs-number">1</span>   <span class="hljs-number">-0.555730</span></span><br><span class="line">   <span class="hljs-number">3</span>    <span class="hljs-number">1.965781</span></span><br><span class="line">c  <span class="hljs-number">1</span>    <span class="hljs-number">1.393406</span></span><br><span class="line">   <span class="hljs-number">2</span>    <span class="hljs-number">0.092908</span></span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">14</span>]: data.loc[[<span class="hljs-string">'b'</span>, <span class="hljs-string">'d'</span>]]</span><br><span class="line">Out[<span class="hljs-number">14</span>]: </span><br><span class="line">b  <span class="hljs-number">1</span>   <span class="hljs-number">-0.555730</span></span><br><span class="line">   <span class="hljs-number">3</span>    <span class="hljs-number">1.965781</span></span><br><span class="line">d  <span class="hljs-number">2</span>    <span class="hljs-number">0.281746</span></span><br><span class="line">   <span class="hljs-number">3</span>    <span class="hljs-number">0.769023</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>

<p>有时甚至还可以在“内层”中进行选取：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">15</span>]: data.loc[:, <span class="hljs-number">2</span>]</span><br><span class="line">Out[<span class="hljs-number">15</span>]: </span><br><span class="line">a    <span class="hljs-number">0.478943</span></span><br><span class="line">c    <span class="hljs-number">0.092908</span></span><br><span class="line">d    <span class="hljs-number">0.281746</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>

<p>层次化索引在数据重塑和基于分组的操作（如透视表生成）中扮演着重要的角色。例如，可以通过unstack方法将这段数据重新安排到一个DataFrame中：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">16</span>]: data.unstack()</span><br><span class="line">Out[<span class="hljs-number">16</span>]: </span><br><span class="line">          <span class="hljs-number">1</span>         <span class="hljs-number">2</span>         <span class="hljs-number">3</span></span><br><span class="line">a <span class="hljs-number">-0.204708</span>  <span class="hljs-number">0.478943</span> <span class="hljs-number">-0.519439</span></span><br><span class="line">b <span class="hljs-number">-0.555730</span>       NaN  <span class="hljs-number">1.965781</span></span><br><span class="line">c  <span class="hljs-number">1.393406</span>  <span class="hljs-number">0.092908</span>       NaN</span><br><span class="line">d       NaN  <span class="hljs-number">0.281746</span>  <span class="hljs-number">0.769023</span></span><br></pre></td></tr></table></figure>

<p>unstack的逆运算是stack：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">17</span>]: data.unstack().stack()</span><br><span class="line">Out[<span class="hljs-number">17</span>]: </span><br><span class="line">a  <span class="hljs-number">1</span>   <span class="hljs-number">-0.204708</span></span><br><span class="line">   <span class="hljs-number">2</span>    <span class="hljs-number">0.478943</span></span><br><span class="line">   <span class="hljs-number">3</span>   <span class="hljs-number">-0.519439</span></span><br><span class="line">b  <span class="hljs-number">1</span>   <span class="hljs-number">-0.555730</span></span><br><span class="line">   <span class="hljs-number">3</span>    <span class="hljs-number">1.965781</span></span><br><span class="line">c  <span class="hljs-number">1</span>    <span class="hljs-number">1.393406</span></span><br><span class="line">   <span class="hljs-number">2</span>    <span class="hljs-number">0.092908</span></span><br><span class="line">d  <span class="hljs-number">2</span>    <span class="hljs-number">0.281746</span></span><br><span class="line">   <span class="hljs-number">3</span>    <span class="hljs-number">0.769023</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>

<p>stack和unstack将在本章后面详细讲解。</p>
<p>对于一个DataFrame，每条轴都可以有分层索引：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">18</span>]: frame = pd.DataFrame(np.arange(<span class="hljs-number">12</span>).reshape((<span class="hljs-number">4</span>, <span class="hljs-number">3</span>)),</span><br><span class="line">   ....:                      index=[[<span class="hljs-string">'a'</span>, <span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'b'</span>], [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>]],</span><br><span class="line">   ....:                      columns=[[<span class="hljs-string">'Ohio'</span>, <span class="hljs-string">'Ohio'</span>, <span class="hljs-string">'Colorado'</span>],</span><br><span class="line">   ....:                               [<span class="hljs-string">'Green'</span>, <span class="hljs-string">'Red'</span>, <span class="hljs-string">'Green'</span>]])</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">19</span>]: frame</span><br><span class="line">Out[<span class="hljs-number">19</span>]: </span><br><span class="line">     Ohio     Colorado</span><br><span class="line">    Green Red    Green</span><br><span class="line">a <span class="hljs-number">1</span>     <span class="hljs-number">0</span>   <span class="hljs-number">1</span>        <span class="hljs-number">2</span></span><br><span class="line">  <span class="hljs-number">2</span>     <span class="hljs-number">3</span>   <span class="hljs-number">4</span>        <span class="hljs-number">5</span></span><br><span class="line">b <span class="hljs-number">1</span>     <span class="hljs-number">6</span>   <span class="hljs-number">7</span>        <span class="hljs-number">8</span></span><br><span class="line">  <span class="hljs-number">2</span>     <span class="hljs-number">9</span>  <span class="hljs-number">10</span>       <span class="hljs-number">11</span></span><br></pre></td></tr></table></figure>

<p>各层都可以有名字（可以是字符串，也可以是别的Python对象）。如果指定了名称，它们就会显示在控制台输出中：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">20</span>]: frame.index.names = [<span class="hljs-string">'key1'</span>, <span class="hljs-string">'key2'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">21</span>]: frame.columns.names = [<span class="hljs-string">'state'</span>, <span class="hljs-string">'color'</span>]</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">22</span>]: frame</span><br><span class="line">Out[<span class="hljs-number">22</span>]: </span><br><span class="line">state      Ohio     Colorado</span><br><span class="line">color     Green Red    Green</span><br><span class="line">key1 key2                   </span><br><span class="line">a    <span class="hljs-number">1</span>        <span class="hljs-number">0</span>   <span class="hljs-number">1</span>        <span class="hljs-number">2</span></span><br><span class="line">     <span class="hljs-number">2</span>        <span class="hljs-number">3</span>   <span class="hljs-number">4</span>        <span class="hljs-number">5</span></span><br><span class="line">b    <span class="hljs-number">1</span>        <span class="hljs-number">6</span>   <span class="hljs-number">7</span>        <span class="hljs-number">8</span></span><br><span class="line">     <span class="hljs-number">2</span>        <span class="hljs-number">9</span>  <span class="hljs-number">10</span>       <span class="hljs-number">11</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：小心区分索引名state、color与行标签。</p>
</blockquote>
<p>有了部分列索引，因此可以轻松选取列分组：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">23</span>]: frame[<span class="hljs-string">'Ohio'</span>]</span><br><span class="line">Out[<span class="hljs-number">23</span>]: </span><br><span class="line">color      Green  Red</span><br><span class="line">key1 key2            </span><br><span class="line">a    <span class="hljs-number">1</span>         <span class="hljs-number">0</span>    <span class="hljs-number">1</span></span><br><span class="line">     <span class="hljs-number">2</span>         <span class="hljs-number">3</span>    <span class="hljs-number">4</span></span><br><span class="line">b    <span class="hljs-number">1</span>         <span class="hljs-number">6</span>    <span class="hljs-number">7</span></span><br><span class="line">     <span class="hljs-number">2</span>         <span class="hljs-number">9</span>   <span class="hljs-number">10</span></span><br></pre></td></tr></table></figure>

<p>可以单独创建MultiIndex然后复用。上面那个DataFrame中的（带有分级名称）列可以这样创建：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MultiIndex.from_arrays([[<span class="hljs-string">'Ohio'</span>, <span class="hljs-string">'Ohio'</span>, <span class="hljs-string">'Colorado'</span>], [<span class="hljs-string">'Green'</span>, <span class="hljs-string">'Red'</span>, <span class="hljs-string">'Green'</span>]],</span><br><span class="line">                       names=[<span class="hljs-string">'state'</span>, <span class="hljs-string">'color'</span>])</span><br></pre></td></tr></table></figure>

<h2 id="重排与分级排序"><a href="#重排与分级排序" class="headerlink" title="重排与分级排序"></a>重排与分级排序</h2><p>有时，你需要重新调整某条轴上各级别的顺序，或根据指定级别上的值对数据进行排序。swaplevel接受两个级别编号或名称，并返回一个互换了级别的新对象（但数据不会发生变化）：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">24</span>]: frame.swaplevel(<span class="hljs-string">'key1'</span>, <span class="hljs-string">'key2'</span>)</span><br><span class="line">Out[<span class="hljs-number">24</span>]: </span><br><span class="line">state      Ohio     Colorado</span><br><span class="line">color     Green Red    Green</span><br><span class="line">key2 key1                   </span><br><span class="line"><span class="hljs-number">1</span>    a        <span class="hljs-number">0</span>   <span class="hljs-number">1</span>        <span class="hljs-number">2</span></span><br><span class="line"><span class="hljs-number">2</span>    a        <span class="hljs-number">3</span>   <span class="hljs-number">4</span>        <span class="hljs-number">5</span></span><br><span class="line"><span class="hljs-number">1</span>    b        <span class="hljs-number">6</span>   <span class="hljs-number">7</span>        <span class="hljs-number">8</span></span><br><span class="line"><span class="hljs-number">2</span>    b        <span class="hljs-number">9</span>  <span class="hljs-number">10</span>       <span class="hljs-number">11</span></span><br></pre></td></tr></table></figure>

<p>而sort_index则根据单个级别中的值对数据进行排序。交换级别时，常常也会用到sort_index，这样最终结果就是按照指定顺序进行字母排序了：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">25</span>]: frame.sort_index(level=<span class="hljs-number">1</span>)</span><br><span class="line">Out[<span class="hljs-number">25</span>]: </span><br><span class="line">state      Ohio     Colorado</span><br><span class="line">color     Green Red    Green</span><br><span class="line">key1 key2                   </span><br><span class="line">a    <span class="hljs-number">1</span>        <span class="hljs-number">0</span>   <span class="hljs-number">1</span>        <span class="hljs-number">2</span></span><br><span class="line">b    <span class="hljs-number">1</span>        <span class="hljs-number">6</span>   <span class="hljs-number">7</span>        <span class="hljs-number">8</span></span><br><span class="line">a    <span class="hljs-number">2</span>        <span class="hljs-number">3</span>   <span class="hljs-number">4</span>        <span class="hljs-number">5</span></span><br><span class="line">b    <span class="hljs-number">2</span>        <span class="hljs-number">9</span>  <span class="hljs-number">10</span>       <span class="hljs-number">11</span></span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">26</span>]: frame.swaplevel(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>).sort_index(level=<span class="hljs-number">0</span>)</span><br><span class="line">Out[<span class="hljs-number">26</span>]: </span><br><span class="line">state      Ohio     Colorado</span><br><span class="line">color     Green Red    Green</span><br><span class="line">key2 key1                   </span><br><span class="line"><span class="hljs-number">1</span>    a        <span class="hljs-number">0</span>   <span class="hljs-number">1</span>        <span class="hljs-number">2</span></span><br><span class="line">     b        <span class="hljs-number">6</span>   <span class="hljs-number">7</span>        <span class="hljs-number">8</span></span><br><span class="line"><span class="hljs-number">2</span>    a        <span class="hljs-number">3</span>   <span class="hljs-number">4</span>        <span class="hljs-number">5</span></span><br><span class="line">     b        <span class="hljs-number">9</span>  <span class="hljs-number">10</span>       <span class="hljs-number">11</span></span><br></pre></td></tr></table></figure>

<h2 id="根据级别汇总统计"><a href="#根据级别汇总统计" class="headerlink" title="根据级别汇总统计"></a>根据级别汇总统计</h2><p>许多对DataFrame和Series的描述和汇总统计都有一个level选项，它用于指定在某条轴上求和的级别。再以上面那个DataFrame为例，我们可以根据行或列上的级别来进行求和：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">27</span>]: frame.sum(level=<span class="hljs-string">'key2'</span>)</span><br><span class="line">Out[<span class="hljs-number">27</span>]: </span><br><span class="line">state  Ohio     Colorado</span><br><span class="line">color Green Red    Green</span><br><span class="line">key2                    </span><br><span class="line"><span class="hljs-number">1</span>         <span class="hljs-number">6</span>   <span class="hljs-number">8</span>       <span class="hljs-number">10</span></span><br><span class="line"><span class="hljs-number">2</span>        <span class="hljs-number">12</span>  <span class="hljs-number">14</span>       <span class="hljs-number">16</span></span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">28</span>]: frame.sum(level=<span class="hljs-string">'color'</span>, axis=<span class="hljs-number">1</span>)</span><br><span class="line">Out[<span class="hljs-number">28</span>]: </span><br><span class="line">color      Green  Red</span><br><span class="line">key1 key2            </span><br><span class="line">a    <span class="hljs-number">1</span>         <span class="hljs-number">2</span>    <span class="hljs-number">1</span></span><br><span class="line">     <span class="hljs-number">2</span>         <span class="hljs-number">8</span>    <span class="hljs-number">4</span></span><br><span class="line">b    <span class="hljs-number">1</span>        <span class="hljs-number">14</span>    <span class="hljs-number">7</span></span><br><span class="line">     <span class="hljs-number">2</span>        <span class="hljs-number">20</span>   <span class="hljs-number">10</span></span><br></pre></td></tr></table></figure>

<p>这其实是利用了pandas的groupby功能，本书稍后将对其进行详细讲解。</p>
<h2 id="使用DataFrame的列进行索引"><a href="#使用DataFrame的列进行索引" class="headerlink" title="使用DataFrame的列进行索引"></a>使用DataFrame的列进行索引</h2><p>人们经常想要将DataFrame的一个或多个列当做行索引来用，或者可能希望将行索引变成DataFrame的列。以下面这个DataFrame为例：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">29</span>]: frame = pd.DataFrame(&#123;<span class="hljs-string">'a'</span>: range(<span class="hljs-number">7</span>), <span class="hljs-string">'b'</span>: range(<span class="hljs-number">7</span>, <span class="hljs-number">0</span>, <span class="hljs-number">-1</span>),</span><br><span class="line">   ....:                       <span class="hljs-string">'c'</span>: [<span class="hljs-string">'one'</span>, <span class="hljs-string">'one'</span>, <span class="hljs-string">'one'</span>, <span class="hljs-string">'two'</span>, <span class="hljs-string">'two'</span>,</span><br><span class="line">   ....:                             <span class="hljs-string">'two'</span>, <span class="hljs-string">'two'</span>],</span><br><span class="line">   ....:                       <span class="hljs-string">'d'</span>: [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">30</span>]: frame</span><br><span class="line">Out[<span class="hljs-number">30</span>]: </span><br><span class="line">   a  b    c  d</span><br><span class="line"><span class="hljs-number">0</span>  <span class="hljs-number">0</span>  <span class="hljs-number">7</span>  one  <span class="hljs-number">0</span></span><br><span class="line"><span class="hljs-number">1</span>  <span class="hljs-number">1</span>  <span class="hljs-number">6</span>  one  <span class="hljs-number">1</span></span><br><span class="line"><span class="hljs-number">2</span>  <span class="hljs-number">2</span>  <span class="hljs-number">5</span>  one  <span class="hljs-number">2</span></span><br><span class="line"><span class="hljs-number">3</span>  <span class="hljs-number">3</span>  <span class="hljs-number">4</span>  two  <span class="hljs-number">0</span></span><br><span class="line"><span class="hljs-number">4</span>  <span class="hljs-number">4</span>  <span class="hljs-number">3</span>  two  <span class="hljs-number">1</span></span><br><span class="line"><span class="hljs-number">5</span>  <span class="hljs-number">5</span>  <span class="hljs-number">2</span>  two  <span class="hljs-number">2</span></span><br><span class="line"><span class="hljs-number">6</span>  <span class="hljs-number">6</span>  <span class="hljs-number">1</span>  two  <span class="hljs-number">3</span></span><br></pre></td></tr></table></figure>

<p>DataFrame的set_index函数会将其一个或多个列转换为行索引，并创建一个新的DataFrame：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">31</span>]: frame2 = frame.set_index([<span class="hljs-string">'c'</span>, <span class="hljs-string">'d'</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">32</span>]: frame2</span><br><span class="line">Out[<span class="hljs-number">32</span>]: </span><br><span class="line">       a  b</span><br><span class="line">c   d      </span><br><span class="line">one <span class="hljs-number">0</span>  <span class="hljs-number">0</span>  <span class="hljs-number">7</span></span><br><span class="line">    <span class="hljs-number">1</span>  <span class="hljs-number">1</span>  <span class="hljs-number">6</span></span><br><span class="line">    <span class="hljs-number">2</span>  <span class="hljs-number">2</span>  <span class="hljs-number">5</span></span><br><span class="line">two <span class="hljs-number">0</span>  <span class="hljs-number">3</span>  <span class="hljs-number">4</span></span><br><span class="line">    <span class="hljs-number">1</span>  <span class="hljs-number">4</span>  <span class="hljs-number">3</span></span><br><span class="line">    <span class="hljs-number">2</span>  <span class="hljs-number">5</span>  <span class="hljs-number">2</span></span><br><span class="line">    <span class="hljs-number">3</span>  <span class="hljs-number">6</span>  <span class="hljs-number">1</span></span><br></pre></td></tr></table></figure>

<p>默认情况下，那些列会从DataFrame中移除，但也可以将其保留下来：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">33</span>]: frame.set_index([<span class="hljs-string">'c'</span>, <span class="hljs-string">'d'</span>], drop=<span class="hljs-literal">False</span>)</span><br><span class="line">Out[<span class="hljs-number">33</span>]: </span><br><span class="line">       a  b    c  d</span><br><span class="line">c   d              </span><br><span class="line">one <span class="hljs-number">0</span>  <span class="hljs-number">0</span>  <span class="hljs-number">7</span>  one  <span class="hljs-number">0</span></span><br><span class="line">    <span class="hljs-number">1</span>  <span class="hljs-number">1</span>  <span class="hljs-number">6</span>  one  <span class="hljs-number">1</span></span><br><span class="line">    <span class="hljs-number">2</span>  <span class="hljs-number">2</span>  <span class="hljs-number">5</span>  one  <span class="hljs-number">2</span></span><br><span class="line">two <span class="hljs-number">0</span>  <span class="hljs-number">3</span>  <span class="hljs-number">4</span>  two  <span class="hljs-number">0</span></span><br><span class="line">    <span class="hljs-number">1</span>  <span class="hljs-number">4</span>  <span class="hljs-number">3</span>  two  <span class="hljs-number">1</span></span><br><span class="line">    <span class="hljs-number">2</span>  <span class="hljs-number">5</span>  <span class="hljs-number">2</span>  two  <span class="hljs-number">2</span></span><br><span class="line">    <span class="hljs-number">3</span>  <span class="hljs-number">6</span>  <span class="hljs-number">1</span>  two  <span class="hljs-number">3</span></span><br></pre></td></tr></table></figure>

<p>reset_index的功能跟set_index刚好相反，层次化索引的级别会被转移到列里面：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">34</span>]: frame2.reset_index()</span><br><span class="line">Out[<span class="hljs-number">34</span>]:</span><br><span class="line">c  d  a  b</span><br><span class="line"><span class="hljs-number">0</span>  one  <span class="hljs-number">0</span>  <span class="hljs-number">0</span>  <span class="hljs-number">7</span></span><br><span class="line"><span class="hljs-number">1</span>  one  <span class="hljs-number">1</span>  <span class="hljs-number">1</span>  <span class="hljs-number">6</span></span><br><span class="line"><span class="hljs-number">2</span>  one  <span class="hljs-number">2</span>  <span class="hljs-number">2</span>  <span class="hljs-number">5</span></span><br><span class="line"><span class="hljs-number">3</span>  two  <span class="hljs-number">0</span>  <span class="hljs-number">3</span>  <span class="hljs-number">4</span></span><br><span class="line"><span class="hljs-number">4</span>  two  <span class="hljs-number">1</span>  <span class="hljs-number">4</span>  <span class="hljs-number">3</span></span><br><span class="line"><span class="hljs-number">5</span>  two  <span class="hljs-number">2</span>  <span class="hljs-number">5</span>  <span class="hljs-number">2</span></span><br><span class="line"><span class="hljs-number">6</span>  two  <span class="hljs-number">3</span>  <span class="hljs-number">6</span>  <span class="hljs-number">1</span></span><br></pre></td></tr></table></figure>

<h1 id="8-2-合并数据集"><a href="#8-2-合并数据集" class="headerlink" title="8.2 合并数据集"></a>8.2 合并数据集</h1><p>pandas对象中的数据可以通过一些方式进行合并：</p>
<ul>
<li>pandas.merge可根据一个或多个键将不同DataFrame中的行连接起来。SQL或其他关系型数据库的用户对此应该会比较熟悉，因为它实现的就是数据库的join操作。</li>
<li>pandas.concat可以沿着一条轴将多个对象堆叠到一起。</li>
<li>实例方法combine_first可以将重复数据拼接在一起，用一个对象中的值填充另一个对象中的缺失值。</li>
</ul>
<p>我将分别对它们进行讲解，并给出一些例子。本书剩余部分的示例中将经常用到它们。</p>
<h2 id="数据库风格的DataFrame合并"><a href="#数据库风格的DataFrame合并" class="headerlink" title="数据库风格的DataFrame合并"></a>数据库风格的DataFrame合并</h2><p>数据集的合并（merge）或连接（join）运算是通过一个或多个键将行连接起来的。这些运算是关系型数据库（基于SQL）的核心。pandas的merge函数是对数据应用这些算法的主要切入点。</p>
<p>以一个简单的例子开始：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">35</span>]: df1 = pd.DataFrame(&#123;<span class="hljs-string">'key'</span>: [<span class="hljs-string">'b'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'a'</span>, <span class="hljs-string">'c'</span>, <span class="hljs-string">'a'</span>, <span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>],</span><br><span class="line">   ....:                     <span class="hljs-string">'data1'</span>: range(<span class="hljs-number">7</span>)&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">36</span>]: df2 = pd.DataFrame(&#123;<span class="hljs-string">'key'</span>: [<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'d'</span>],</span><br><span class="line">   ....:                     <span class="hljs-string">'data2'</span>: range(<span class="hljs-number">3</span>)&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">37</span>]: df1</span><br><span class="line">Out[<span class="hljs-number">37</span>]: </span><br><span class="line">   data1 key</span><br><span class="line"><span class="hljs-number">0</span>      <span class="hljs-number">0</span>   b</span><br><span class="line"><span class="hljs-number">1</span>      <span class="hljs-number">1</span>   b</span><br><span class="line"><span class="hljs-number">2</span>      <span class="hljs-number">2</span>   a</span><br><span class="line"><span class="hljs-number">3</span>      <span class="hljs-number">3</span>   c</span><br><span class="line"><span class="hljs-number">4</span>      <span class="hljs-number">4</span>   a</span><br><span class="line"><span class="hljs-number">5</span>      <span class="hljs-number">5</span>   a</span><br><span class="line"><span class="hljs-number">6</span>      <span class="hljs-number">6</span>   b</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">38</span>]: df2</span><br><span class="line">Out[<span class="hljs-number">38</span>]: </span><br><span class="line">   data2 key</span><br><span class="line"><span class="hljs-number">0</span>      <span class="hljs-number">0</span>   a</span><br><span class="line"><span class="hljs-number">1</span>      <span class="hljs-number">1</span>   b</span><br><span class="line"><span class="hljs-number">2</span>      <span class="hljs-number">2</span>   d</span><br></pre></td></tr></table></figure>

<p>这是一种多对一的合并。df1中的数据有多个被标记为a和b的行，而df2中key列的每个值则仅对应一行。对这些对象调用merge即可得到：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">39</span>]: pd.merge(df1, df2)</span><br><span class="line">Out[<span class="hljs-number">39</span>]: </span><br><span class="line">   data1 key  data2</span><br><span class="line"><span class="hljs-number">0</span>      <span class="hljs-number">0</span>   b      <span class="hljs-number">1</span></span><br><span class="line"><span class="hljs-number">1</span>      <span class="hljs-number">1</span>   b      <span class="hljs-number">1</span></span><br><span class="line"><span class="hljs-number">2</span>      <span class="hljs-number">6</span>   b      <span class="hljs-number">1</span></span><br><span class="line"><span class="hljs-number">3</span>      <span class="hljs-number">2</span>   a      <span class="hljs-number">0</span></span><br><span class="line"><span class="hljs-number">4</span>      <span class="hljs-number">4</span>   a      <span class="hljs-number">0</span></span><br><span class="line"><span class="hljs-number">5</span>      <span class="hljs-number">5</span>   a      <span class="hljs-number">0</span></span><br></pre></td></tr></table></figure>

<p>注意，我并没有指明要用哪个列进行连接。如果没有指定，merge就会将重叠列的列名当做键。不过，最好明确指定一下：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">40</span>]: pd.merge(df1, df2, on=<span class="hljs-string">'key'</span>)</span><br><span class="line">Out[<span class="hljs-number">40</span>]: </span><br><span class="line">   data1 key  data2</span><br><span class="line"><span class="hljs-number">0</span>      <span class="hljs-number">0</span>   b      <span class="hljs-number">1</span></span><br><span class="line"><span class="hljs-number">1</span>      <span class="hljs-number">1</span>   b      <span class="hljs-number">1</span></span><br><span class="line"><span class="hljs-number">2</span>      <span class="hljs-number">6</span>   b      <span class="hljs-number">1</span></span><br><span class="line"><span class="hljs-number">3</span>      <span class="hljs-number">2</span>   a      <span class="hljs-number">0</span></span><br><span class="line"><span class="hljs-number">4</span>      <span class="hljs-number">4</span>   a      <span class="hljs-number">0</span></span><br><span class="line"><span class="hljs-number">5</span>      <span class="hljs-number">5</span>   a      <span class="hljs-number">0</span></span><br></pre></td></tr></table></figure>

<p>如果两个对象的列名不同，也可以分别进行指定：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">41</span>]: df3 = pd.DataFrame(&#123;<span class="hljs-string">'lkey'</span>: [<span class="hljs-string">'b'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'a'</span>, <span class="hljs-string">'c'</span>, <span class="hljs-string">'a'</span>, <span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>],</span><br><span class="line">   ....:                     <span class="hljs-string">'data1'</span>: range(<span class="hljs-number">7</span>)&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">42</span>]: df4 = pd.DataFrame(&#123;<span class="hljs-string">'rkey'</span>: [<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'d'</span>],</span><br><span class="line">   ....:                     <span class="hljs-string">'data2'</span>: range(<span class="hljs-number">3</span>)&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">43</span>]: pd.merge(df3, df4, left_on=<span class="hljs-string">'lkey'</span>, right_on=<span class="hljs-string">'rkey'</span>)</span><br><span class="line">Out[<span class="hljs-number">43</span>]: </span><br><span class="line">   data1 lkey  data2 rkey</span><br><span class="line"><span class="hljs-number">0</span>      <span class="hljs-number">0</span>    b      <span class="hljs-number">1</span>    b</span><br><span class="line"><span class="hljs-number">1</span>      <span class="hljs-number">1</span>    b      <span class="hljs-number">1</span>    b</span><br><span class="line"><span class="hljs-number">2</span>      <span class="hljs-number">6</span>    b      <span class="hljs-number">1</span>    b</span><br><span class="line"><span class="hljs-number">3</span>      <span class="hljs-number">2</span>    a      <span class="hljs-number">0</span>    a</span><br><span class="line"><span class="hljs-number">4</span>      <span class="hljs-number">4</span>    a      <span class="hljs-number">0</span>    a</span><br><span class="line"><span class="hljs-number">5</span>      <span class="hljs-number">5</span>    a      <span class="hljs-number">0</span>    a</span><br></pre></td></tr></table></figure>

<p>可能你已经注意到了，结果里面c和d以及与之相关的数据消失了。默认情况下，merge做的是“内连接”；结果中的键是交集。其他方式还有”left”、”right”以及”outer”。外连接求取的是键的并集，组合了左连接和右连接的效果：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">44</span>]: pd.merge(df1, df2, how=<span class="hljs-string">'outer'</span>)</span><br><span class="line">Out[<span class="hljs-number">44</span>]: </span><br><span class="line">   data1 key  data2</span><br><span class="line"><span class="hljs-number">0</span>    <span class="hljs-number">0.0</span>   b    <span class="hljs-number">1.0</span></span><br><span class="line"><span class="hljs-number">1</span>    <span class="hljs-number">1.0</span>   b    <span class="hljs-number">1.0</span></span><br><span class="line"><span class="hljs-number">2</span>    <span class="hljs-number">6.0</span>   b    <span class="hljs-number">1.0</span></span><br><span class="line"><span class="hljs-number">3</span>    <span class="hljs-number">2.0</span>   a    <span class="hljs-number">0.0</span></span><br><span class="line"><span class="hljs-number">4</span>    <span class="hljs-number">4.0</span>   a    <span class="hljs-number">0.0</span></span><br><span class="line"><span class="hljs-number">5</span>    <span class="hljs-number">5.0</span>   a    <span class="hljs-number">0.0</span></span><br><span class="line"><span class="hljs-number">6</span>    <span class="hljs-number">3.0</span>   c    NaN</span><br><span class="line"><span class="hljs-number">7</span>    NaN   d    <span class="hljs-number">2.0</span></span><br></pre></td></tr></table></figure>

<p>表8-1对这些选项进行了总结。</p>
<p><img src="/images/blog/7178691-e49b3341f4a3c90e.webp" alt="img"></p>
<p>表8-1 不同的连接类型</p>
<p>多对多的合并有些不直观。看下面的例子：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">45</span>]: df1 = pd.DataFrame(&#123;<span class="hljs-string">'key'</span>: [<span class="hljs-string">'b'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'a'</span>, <span class="hljs-string">'c'</span>, <span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>],</span><br><span class="line">   ....:                     <span class="hljs-string">'data1'</span>: range(<span class="hljs-number">6</span>)&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">46</span>]: df2 = pd.DataFrame(&#123;<span class="hljs-string">'key'</span>: [<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'d'</span>],</span><br><span class="line">   ....:                     <span class="hljs-string">'data2'</span>: range(<span class="hljs-number">5</span>)&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">47</span>]: df1</span><br><span class="line">Out[<span class="hljs-number">47</span>]: </span><br><span class="line">   data1 key</span><br><span class="line"><span class="hljs-number">0</span>      <span class="hljs-number">0</span>   b</span><br><span class="line"><span class="hljs-number">1</span>      <span class="hljs-number">1</span>   b</span><br><span class="line"><span class="hljs-number">2</span>      <span class="hljs-number">2</span>   a</span><br><span class="line"><span class="hljs-number">3</span>      <span class="hljs-number">3</span>   c</span><br><span class="line"><span class="hljs-number">4</span>      <span class="hljs-number">4</span>   a</span><br><span class="line"><span class="hljs-number">5</span>      <span class="hljs-number">5</span>   b</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">48</span>]: df2</span><br><span class="line">Out[<span class="hljs-number">48</span>]: </span><br><span class="line">   data2 key</span><br><span class="line"><span class="hljs-number">0</span>      <span class="hljs-number">0</span>   a</span><br><span class="line"><span class="hljs-number">1</span>      <span class="hljs-number">1</span>   b</span><br><span class="line"><span class="hljs-number">2</span>      <span class="hljs-number">2</span>   a</span><br><span class="line"><span class="hljs-number">3</span>      <span class="hljs-number">3</span>   b</span><br><span class="line"><span class="hljs-number">4</span>      <span class="hljs-number">4</span>   d</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">49</span>]: pd.merge(df1, df2, on=<span class="hljs-string">'key'</span>, how=<span class="hljs-string">'left'</span>)</span><br><span class="line">Out[<span class="hljs-number">49</span>]: </span><br><span class="line">    data1 key  data2</span><br><span class="line"><span class="hljs-number">0</span>       <span class="hljs-number">0</span>   b    <span class="hljs-number">1.0</span></span><br><span class="line"><span class="hljs-number">1</span>       <span class="hljs-number">0</span>   b    <span class="hljs-number">3.0</span></span><br><span class="line"><span class="hljs-number">2</span>       <span class="hljs-number">1</span>   b    <span class="hljs-number">1.0</span></span><br><span class="line"><span class="hljs-number">3</span>       <span class="hljs-number">1</span>   b    <span class="hljs-number">3.0</span></span><br><span class="line"><span class="hljs-number">4</span>       <span class="hljs-number">2</span>   a    <span class="hljs-number">0.0</span></span><br><span class="line"><span class="hljs-number">5</span>       <span class="hljs-number">2</span>   a    <span class="hljs-number">2.0</span></span><br><span class="line"><span class="hljs-number">6</span>       <span class="hljs-number">3</span>   c    NaN</span><br><span class="line"><span class="hljs-number">7</span>       <span class="hljs-number">4</span>   a    <span class="hljs-number">0.0</span></span><br><span class="line"><span class="hljs-number">8</span>       <span class="hljs-number">4</span>   a    <span class="hljs-number">2.0</span></span><br><span class="line"><span class="hljs-number">9</span>       <span class="hljs-number">5</span>   b    <span class="hljs-number">1.0</span></span><br><span class="line"><span class="hljs-number">10</span>      <span class="hljs-number">5</span>   b    <span class="hljs-number">3.0</span></span><br></pre></td></tr></table></figure>

<p>多对多连接产生的是行的笛卡尔积。由于左边的DataFrame有3个”b”行，右边的有2个，所以最终结果中就有6个”b”行。连接方式只影响出现在结果中的不同的键的值：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">50</span>]: pd.merge(df1, df2, how=<span class="hljs-string">'inner'</span>)</span><br><span class="line">Out[<span class="hljs-number">50</span>]: </span><br><span class="line">   data1 key  data2</span><br><span class="line"><span class="hljs-number">0</span>      <span class="hljs-number">0</span>   b      <span class="hljs-number">1</span></span><br><span class="line"><span class="hljs-number">1</span>      <span class="hljs-number">0</span>   b      <span class="hljs-number">3</span></span><br><span class="line"><span class="hljs-number">2</span>      <span class="hljs-number">1</span>   b      <span class="hljs-number">1</span></span><br><span class="line"><span class="hljs-number">3</span>      <span class="hljs-number">1</span>   b      <span class="hljs-number">3</span></span><br><span class="line"><span class="hljs-number">4</span>      <span class="hljs-number">5</span>   b      <span class="hljs-number">1</span></span><br><span class="line"><span class="hljs-number">5</span>      <span class="hljs-number">5</span>   b      <span class="hljs-number">3</span></span><br><span class="line"><span class="hljs-number">6</span>      <span class="hljs-number">2</span>   a      <span class="hljs-number">0</span></span><br><span class="line"><span class="hljs-number">7</span>      <span class="hljs-number">2</span>   a      <span class="hljs-number">2</span></span><br><span class="line"><span class="hljs-number">8</span>      <span class="hljs-number">4</span>   a      <span class="hljs-number">0</span></span><br><span class="line"><span class="hljs-number">9</span>      <span class="hljs-number">4</span>   a      <span class="hljs-number">2</span></span><br></pre></td></tr></table></figure>

<p>要根据多个键进行合并，传入一个由列名组成的列表即可：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">51</span>]: left = pd.DataFrame(&#123;<span class="hljs-string">'key1'</span>: [<span class="hljs-string">'foo'</span>, <span class="hljs-string">'foo'</span>, <span class="hljs-string">'bar'</span>],</span><br><span class="line">   ....:                      <span class="hljs-string">'key2'</span>: [<span class="hljs-string">'one'</span>, <span class="hljs-string">'two'</span>, <span class="hljs-string">'one'</span>],</span><br><span class="line">   ....:                      <span class="hljs-string">'lval'</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">52</span>]: right = pd.DataFrame(&#123;<span class="hljs-string">'key1'</span>: [<span class="hljs-string">'foo'</span>, <span class="hljs-string">'foo'</span>, <span class="hljs-string">'bar'</span>, <span class="hljs-string">'bar'</span>],</span><br><span class="line">   ....:                       <span class="hljs-string">'key2'</span>: [<span class="hljs-string">'one'</span>, <span class="hljs-string">'one'</span>, <span class="hljs-string">'one'</span>, <span class="hljs-string">'two'</span>],</span><br><span class="line">   ....:                       <span class="hljs-string">'rval'</span>: [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>]&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">53</span>]: pd.merge(left, right, on=[<span class="hljs-string">'key1'</span>, <span class="hljs-string">'key2'</span>], how=<span class="hljs-string">'outer'</span>)</span><br><span class="line">Out[<span class="hljs-number">53</span>]: </span><br><span class="line">  key1 key2  lval  rval</span><br><span class="line"><span class="hljs-number">0</span>  foo  one   <span class="hljs-number">1.0</span>   <span class="hljs-number">4.0</span></span><br><span class="line"><span class="hljs-number">1</span>  foo  one   <span class="hljs-number">1.0</span>   <span class="hljs-number">5.0</span></span><br><span class="line"><span class="hljs-number">2</span>  foo  two   <span class="hljs-number">2.0</span>   NaN</span><br><span class="line"><span class="hljs-number">3</span>  bar  one   <span class="hljs-number">3.0</span>   <span class="hljs-number">6.0</span></span><br><span class="line"><span class="hljs-number">4</span>  bar  two   NaN   <span class="hljs-number">7.0</span></span><br></pre></td></tr></table></figure>

<p>结果中会出现哪些键组合取决于所选的合并方式，你可以这样来理解：多个键形成一系列元组，并将其当做单个连接键（当然，实际上并不是这么回事）。</p>
<blockquote>
<p>注意：在进行列－列连接时，DataFrame对象中的索引会被丢弃。</p>
</blockquote>
<p>对于合并运算需要考虑的最后一个问题是对重复列名的处理。虽然你可以手工处理列名重叠的问题（查看前面介绍的重命名轴标签），但merge有一个更实用的suffixes选项，用于指定附加到左右两个DataFrame对象的重叠列名上的字符串：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">54</span>]: pd.merge(left, right, on=<span class="hljs-string">'key1'</span>)</span><br><span class="line">Out[<span class="hljs-number">54</span>]: </span><br><span class="line">  key1 key2_x  lval key2_y  rval</span><br><span class="line"><span class="hljs-number">0</span>  foo    one     <span class="hljs-number">1</span>    one     <span class="hljs-number">4</span></span><br><span class="line"><span class="hljs-number">1</span>  foo    one     <span class="hljs-number">1</span>    one     <span class="hljs-number">5</span></span><br><span class="line"><span class="hljs-number">2</span>  foo    two     <span class="hljs-number">2</span>    one     <span class="hljs-number">4</span></span><br><span class="line"><span class="hljs-number">3</span>  foo    two     <span class="hljs-number">2</span>    one     <span class="hljs-number">5</span></span><br><span class="line"><span class="hljs-number">4</span>  bar    one     <span class="hljs-number">3</span>    one     <span class="hljs-number">6</span></span><br><span class="line"><span class="hljs-number">5</span>  bar    one     <span class="hljs-number">3</span>    two     <span class="hljs-number">7</span></span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">55</span>]: pd.merge(left, right, on=<span class="hljs-string">'key1'</span>, suffixes=(<span class="hljs-string">'_left'</span>, <span class="hljs-string">'_right'</span>))</span><br><span class="line">Out[<span class="hljs-number">55</span>]: </span><br><span class="line">  key1 key2_left  lval key2_right  rval</span><br><span class="line"><span class="hljs-number">0</span>  foo       one     <span class="hljs-number">1</span>        one     <span class="hljs-number">4</span></span><br><span class="line"><span class="hljs-number">1</span>  foo       one     <span class="hljs-number">1</span>        one     <span class="hljs-number">5</span></span><br><span class="line"><span class="hljs-number">2</span>  foo       two     <span class="hljs-number">2</span>        one     <span class="hljs-number">4</span></span><br><span class="line"><span class="hljs-number">3</span>  foo       two     <span class="hljs-number">2</span>        one     <span class="hljs-number">5</span></span><br><span class="line"><span class="hljs-number">4</span>  bar       one     <span class="hljs-number">3</span>        one     <span class="hljs-number">6</span></span><br><span class="line"><span class="hljs-number">5</span>  bar       one     <span class="hljs-number">3</span>        two     <span class="hljs-number">7</span></span><br></pre></td></tr></table></figure>

<p>merge的参数请参见表8-2。使用DataFrame的行索引合并是下一节的主题。</p>
<p>表8-2 merge函数的参数</p>
<p><img src="/images/blog/7178691-35ca716a4f1b8475.webp" alt="img"></p>
<p><img src="/images/blog/7178691-c86672e733ceccd9.webp" alt="img"></p>
<p>indicator 添加特殊的列_merge，它可以指明每个行的来源，它的值有left_only、right_only或both，根据每行的合并数据的来源。</p>
<h2 id="索引上的合并"><a href="#索引上的合并" class="headerlink" title="索引上的合并"></a>索引上的合并</h2><p>有时候，DataFrame中的连接键位于其索引中。在这种情况下，你可以传入left_index=True或right_index=True（或两个都传）以说明索引应该被用作连接键：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">56</span>]: left1 = pd.DataFrame(&#123;<span class="hljs-string">'key'</span>: [<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'a'</span>, <span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>],</span><br><span class="line">   ....:                       <span class="hljs-string">'value'</span>: range(<span class="hljs-number">6</span>)&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">57</span>]: right1 = pd.DataFrame(&#123;<span class="hljs-string">'group_val'</span>: [<span class="hljs-number">3.5</span>, <span class="hljs-number">7</span>]&#125;, index=[<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">58</span>]: left1</span><br><span class="line">Out[<span class="hljs-number">58</span>]:</span><br><span class="line"></span><br><span class="line">  key  value</span><br><span class="line"><span class="hljs-number">0</span>   a      <span class="hljs-number">0</span></span><br><span class="line"><span class="hljs-number">1</span>   b      <span class="hljs-number">1</span></span><br><span class="line"><span class="hljs-number">2</span>   a      <span class="hljs-number">2</span></span><br><span class="line"><span class="hljs-number">3</span>   a      <span class="hljs-number">3</span></span><br><span class="line"><span class="hljs-number">4</span>   b      <span class="hljs-number">4</span></span><br><span class="line"><span class="hljs-number">5</span>   c      <span class="hljs-number">5</span></span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">59</span>]: right1</span><br><span class="line">Out[<span class="hljs-number">59</span>]: </span><br><span class="line">   group_val</span><br><span class="line">a        <span class="hljs-number">3.5</span></span><br><span class="line">b        <span class="hljs-number">7.0</span></span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">60</span>]: pd.merge(left1, right1, left_on=<span class="hljs-string">'key'</span>, right_index=<span class="hljs-literal">True</span>)</span><br><span class="line">Out[<span class="hljs-number">60</span>]: </span><br><span class="line">  key  value  group_val</span><br><span class="line"><span class="hljs-number">0</span>   a      <span class="hljs-number">0</span>        <span class="hljs-number">3.5</span></span><br><span class="line"><span class="hljs-number">2</span>   a      <span class="hljs-number">2</span>        <span class="hljs-number">3.5</span></span><br><span class="line"><span class="hljs-number">3</span>   a      <span class="hljs-number">3</span>        <span class="hljs-number">3.5</span></span><br><span class="line"><span class="hljs-number">1</span>   b      <span class="hljs-number">1</span>        <span class="hljs-number">7.0</span></span><br><span class="line"><span class="hljs-number">4</span>   b      <span class="hljs-number">4</span>        <span class="hljs-number">7.0</span></span><br></pre></td></tr></table></figure>

<p>由于默认的merge方法是求取连接键的交集，因此你可以通过外连接的方式得到它们的并集：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">61</span>]: pd.merge(left1, right1, left_on=<span class="hljs-string">'key'</span>, right_index=<span class="hljs-literal">True</span>, how=<span class="hljs-string">'outer'</span>)</span><br><span class="line">Out[<span class="hljs-number">61</span>]: </span><br><span class="line">  key  value  group_val</span><br><span class="line"><span class="hljs-number">0</span>   a      <span class="hljs-number">0</span>        <span class="hljs-number">3.5</span></span><br><span class="line"><span class="hljs-number">2</span>   a      <span class="hljs-number">2</span>        <span class="hljs-number">3.5</span></span><br><span class="line"><span class="hljs-number">3</span>   a      <span class="hljs-number">3</span>        <span class="hljs-number">3.5</span></span><br><span class="line"><span class="hljs-number">1</span>   b      <span class="hljs-number">1</span>        <span class="hljs-number">7.0</span></span><br><span class="line"><span class="hljs-number">4</span>   b      <span class="hljs-number">4</span>        <span class="hljs-number">7.0</span></span><br><span class="line"><span class="hljs-number">5</span>   c      <span class="hljs-number">5</span>        NaN</span><br></pre></td></tr></table></figure>

<p>对于层次化索引的数据，事情就有点复杂了，因为索引的合并默认是多键合并：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">62</span>]: lefth = pd.DataFrame(&#123;<span class="hljs-string">'key1'</span>: [<span class="hljs-string">'Ohio'</span>, <span class="hljs-string">'Ohio'</span>, <span class="hljs-string">'Ohio'</span>,</span><br><span class="line">   ....:                                <span class="hljs-string">'Nevada'</span>, <span class="hljs-string">'Nevada'</span>],</span><br><span class="line">   ....:                       <span class="hljs-string">'key2'</span>: [<span class="hljs-number">2000</span>, <span class="hljs-number">2001</span>, <span class="hljs-number">2002</span>, <span class="hljs-number">2001</span>, <span class="hljs-number">2002</span>],</span><br><span class="line">   ....:                       <span class="hljs-string">'data'</span>: np.arange(<span class="hljs-number">5.</span>)&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">63</span>]: righth = pd.DataFrame(np.arange(<span class="hljs-number">12</span>).reshape((<span class="hljs-number">6</span>, <span class="hljs-number">2</span>)),</span><br><span class="line">   ....:                       index=[[<span class="hljs-string">'Nevada'</span>, <span class="hljs-string">'Nevada'</span>, <span class="hljs-string">'Ohio'</span>, <span class="hljs-string">'Ohio'</span>,</span><br><span class="line">   ....:                               <span class="hljs-string">'Ohio'</span>, <span class="hljs-string">'Ohio'</span>],</span><br><span class="line">   ....:                              [<span class="hljs-number">2001</span>, <span class="hljs-number">2000</span>, <span class="hljs-number">2000</span>, <span class="hljs-number">2000</span>, <span class="hljs-number">2001</span>, <span class="hljs-number">2002</span>]],</span><br><span class="line">   ....:                       columns=[<span class="hljs-string">'event1'</span>, <span class="hljs-string">'event2'</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">64</span>]: lefth</span><br><span class="line">Out[<span class="hljs-number">64</span>]: </span><br><span class="line">   data    key1  key2</span><br><span class="line"><span class="hljs-number">0</span>   <span class="hljs-number">0.0</span>    Ohio  <span class="hljs-number">2000</span></span><br><span class="line"><span class="hljs-number">1</span>   <span class="hljs-number">1.0</span>    Ohio  <span class="hljs-number">2001</span></span><br><span class="line"><span class="hljs-number">2</span>   <span class="hljs-number">2.0</span>    Ohio  <span class="hljs-number">2002</span></span><br><span class="line"><span class="hljs-number">3</span>   <span class="hljs-number">3.0</span>  Nevada  <span class="hljs-number">2001</span></span><br><span class="line"><span class="hljs-number">4</span>   <span class="hljs-number">4.0</span>  Nevada  <span class="hljs-number">2002</span></span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">65</span>]: righth</span><br><span class="line">Out[<span class="hljs-number">65</span>]: </span><br><span class="line">             event1  event2</span><br><span class="line">Nevada <span class="hljs-number">2001</span>       <span class="hljs-number">0</span>       <span class="hljs-number">1</span></span><br><span class="line">       <span class="hljs-number">2000</span>       <span class="hljs-number">2</span>       <span class="hljs-number">3</span></span><br><span class="line">Ohio   <span class="hljs-number">2000</span>       <span class="hljs-number">4</span>       <span class="hljs-number">5</span></span><br><span class="line">       <span class="hljs-number">2000</span>       <span class="hljs-number">6</span>       <span class="hljs-number">7</span></span><br><span class="line">       <span class="hljs-number">2001</span>       <span class="hljs-number">8</span>       <span class="hljs-number">9</span></span><br><span class="line">       <span class="hljs-number">2002</span>      <span class="hljs-number">10</span>      <span class="hljs-number">11</span></span><br></pre></td></tr></table></figure>

<p>这种情况下，你必须以列表的形式指明用作合并键的多个列（注意用how=’outer’对重复索引值的处理）：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">66</span>]: pd.merge(lefth, righth, left_on=[<span class="hljs-string">'key1'</span>, <span class="hljs-string">'key2'</span>], right_index=<span class="hljs-literal">True</span>)</span><br><span class="line">Out[<span class="hljs-number">66</span>]: </span><br><span class="line">   data    key1  key2  event1  event2</span><br><span class="line"><span class="hljs-number">0</span>   <span class="hljs-number">0.0</span>    Ohio  <span class="hljs-number">2000</span>       <span class="hljs-number">4</span>       <span class="hljs-number">5</span></span><br><span class="line"><span class="hljs-number">0</span>   <span class="hljs-number">0.0</span>    Ohio  <span class="hljs-number">2000</span>       <span class="hljs-number">6</span>       <span class="hljs-number">7</span></span><br><span class="line"><span class="hljs-number">1</span>   <span class="hljs-number">1.0</span>    Ohio  <span class="hljs-number">2001</span>       <span class="hljs-number">8</span>       <span class="hljs-number">9</span></span><br><span class="line"><span class="hljs-number">2</span>   <span class="hljs-number">2.0</span>    Ohio  <span class="hljs-number">2002</span>      <span class="hljs-number">10</span>      <span class="hljs-number">11</span></span><br><span class="line"><span class="hljs-number">3</span>   <span class="hljs-number">3.0</span>  Nevada  <span class="hljs-number">2001</span>       <span class="hljs-number">0</span>       <span class="hljs-number">1</span></span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">67</span>]: pd.merge(lefth, righth, left_on=[<span class="hljs-string">'key1'</span>, <span class="hljs-string">'key2'</span>],</span><br><span class="line">   ....:          right_index=<span class="hljs-literal">True</span>, how=<span class="hljs-string">'outer'</span>)</span><br><span class="line">Out[<span class="hljs-number">67</span>]: </span><br><span class="line">   data    key1  key2  event1  event2</span><br><span class="line"><span class="hljs-number">0</span>   <span class="hljs-number">0.0</span>    Ohio  <span class="hljs-number">2000</span>     <span class="hljs-number">4.0</span>     <span class="hljs-number">5.0</span></span><br><span class="line"><span class="hljs-number">0</span>   <span class="hljs-number">0.0</span>    Ohio  <span class="hljs-number">2000</span>     <span class="hljs-number">6.0</span>     <span class="hljs-number">7.0</span></span><br><span class="line"><span class="hljs-number">1</span>   <span class="hljs-number">1.0</span>    Ohio  <span class="hljs-number">2001</span>     <span class="hljs-number">8.0</span>     <span class="hljs-number">9.0</span></span><br><span class="line"><span class="hljs-number">2</span>   <span class="hljs-number">2.0</span>    Ohio  <span class="hljs-number">2002</span>    <span class="hljs-number">10.0</span>    <span class="hljs-number">11.0</span></span><br><span class="line"><span class="hljs-number">3</span>   <span class="hljs-number">3.0</span>  Nevada  <span class="hljs-number">2001</span>     <span class="hljs-number">0.0</span>     <span class="hljs-number">1.0</span></span><br><span class="line"><span class="hljs-number">4</span>   <span class="hljs-number">4.0</span>  Nevada  <span class="hljs-number">2002</span>     NaN     NaN</span><br><span class="line"><span class="hljs-number">4</span>   NaN  Nevada  <span class="hljs-number">2000</span>     <span class="hljs-number">2.0</span>     <span class="hljs-number">3.0</span></span><br></pre></td></tr></table></figure>

<p>同时使用合并双方的索引也没问题：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">68</span>]: left2 = pd.DataFrame([[<span class="hljs-number">1.</span>, <span class="hljs-number">2.</span>], [<span class="hljs-number">3.</span>, <span class="hljs-number">4.</span>], [<span class="hljs-number">5.</span>, <span class="hljs-number">6.</span>]],</span><br><span class="line">   ....:                      index=[<span class="hljs-string">'a'</span>, <span class="hljs-string">'c'</span>, <span class="hljs-string">'e'</span>],</span><br><span class="line">   ....:                      columns=[<span class="hljs-string">'Ohio'</span>, <span class="hljs-string">'Nevada'</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">69</span>]: right2 = pd.DataFrame([[<span class="hljs-number">7.</span>, <span class="hljs-number">8.</span>], [<span class="hljs-number">9.</span>, <span class="hljs-number">10.</span>], [<span class="hljs-number">11.</span>, <span class="hljs-number">12.</span>], [<span class="hljs-number">13</span>, <span class="hljs-number">14</span>]],</span><br><span class="line">   ....:                       index=[<span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>, <span class="hljs-string">'d'</span>, <span class="hljs-string">'e'</span>],</span><br><span class="line">   ....:                       columns=[<span class="hljs-string">'Missouri'</span>, <span class="hljs-string">'Alabama'</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">70</span>]: left2</span><br><span class="line">Out[<span class="hljs-number">70</span>]: </span><br><span class="line">   Ohio  Nevada</span><br><span class="line">a   <span class="hljs-number">1.0</span>     <span class="hljs-number">2.0</span></span><br><span class="line">c   <span class="hljs-number">3.0</span>     <span class="hljs-number">4.0</span></span><br><span class="line">e   <span class="hljs-number">5.0</span>     <span class="hljs-number">6.0</span></span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">71</span>]: right2</span><br><span class="line">Out[<span class="hljs-number">71</span>]: </span><br><span class="line">   Missouri  Alabama</span><br><span class="line">b       <span class="hljs-number">7.0</span>      <span class="hljs-number">8.0</span></span><br><span class="line">c       <span class="hljs-number">9.0</span>     <span class="hljs-number">10.0</span></span><br><span class="line">d      <span class="hljs-number">11.0</span>     <span class="hljs-number">12.0</span></span><br><span class="line">e      <span class="hljs-number">13.0</span>     <span class="hljs-number">14.0</span></span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">72</span>]: pd.merge(left2, right2, how=<span class="hljs-string">'outer'</span>, left_index=<span class="hljs-literal">True</span>, right_index=<span class="hljs-literal">True</span>)</span><br><span class="line">Out[<span class="hljs-number">72</span>]: </span><br><span class="line">   Ohio  Nevada  Missouri  Alabama</span><br><span class="line">a   <span class="hljs-number">1.0</span>     <span class="hljs-number">2.0</span>       NaN      NaN</span><br><span class="line">b   NaN     NaN       <span class="hljs-number">7.0</span>      <span class="hljs-number">8.0</span></span><br><span class="line">c   <span class="hljs-number">3.0</span>     <span class="hljs-number">4.0</span>       <span class="hljs-number">9.0</span>     <span class="hljs-number">10.0</span></span><br><span class="line">d   NaN     NaN      <span class="hljs-number">11.0</span>     <span class="hljs-number">12.0</span></span><br><span class="line">e   <span class="hljs-number">5.0</span>     <span class="hljs-number">6.0</span>      <span class="hljs-number">13.0</span>     <span class="hljs-number">14.0</span></span><br></pre></td></tr></table></figure>

<p>DataFrame还有一个便捷的join实例方法，它能更为方便地实现按索引合并。它还可用于合并多个带有相同或相似索引的DataFrame对象，但要求没有重叠的列。在上面那个例子中，我们可以编写：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">73</span>]: left2.join(right2, how=<span class="hljs-string">'outer'</span>)</span><br><span class="line">Out[<span class="hljs-number">73</span>]: </span><br><span class="line">   Ohio  Nevada  Missouri  Alabama</span><br><span class="line">a   <span class="hljs-number">1.0</span>     <span class="hljs-number">2.0</span>       NaN      NaN</span><br><span class="line">b   NaN     NaN       <span class="hljs-number">7.0</span>      <span class="hljs-number">8.0</span></span><br><span class="line">c   <span class="hljs-number">3.0</span>     <span class="hljs-number">4.0</span>       <span class="hljs-number">9.0</span>     <span class="hljs-number">10.0</span></span><br><span class="line">d   NaN     NaN      <span class="hljs-number">11.0</span>     <span class="hljs-number">12.0</span></span><br><span class="line">e   <span class="hljs-number">5.0</span>     <span class="hljs-number">6.0</span>      <span class="hljs-number">13.0</span>     <span class="hljs-number">14.0</span></span><br></pre></td></tr></table></figure>

<p>因为一些历史版本的遗留原因，DataFrame的join方法默认使用的是左连接，保留左边表的行索引。它还支持在调用的DataFrame的列上，连接传递的DataFrame索引：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">74</span>]: left1.join(right1, on=<span class="hljs-string">'key'</span>)</span><br><span class="line">Out[<span class="hljs-number">74</span>]: </span><br><span class="line">  key  value  group_val</span><br><span class="line"><span class="hljs-number">0</span>   a      <span class="hljs-number">0</span>        <span class="hljs-number">3.5</span></span><br><span class="line"><span class="hljs-number">1</span>   b      <span class="hljs-number">1</span>        <span class="hljs-number">7.0</span></span><br><span class="line"><span class="hljs-number">2</span>   a      <span class="hljs-number">2</span>        <span class="hljs-number">3.5</span></span><br><span class="line"><span class="hljs-number">3</span>   a      <span class="hljs-number">3</span>        <span class="hljs-number">3.5</span></span><br><span class="line"><span class="hljs-number">4</span>   b      <span class="hljs-number">4</span>        <span class="hljs-number">7.0</span></span><br><span class="line"><span class="hljs-number">5</span>   c      <span class="hljs-number">5</span>        NaN</span><br></pre></td></tr></table></figure>

<p>最后，对于简单的索引合并，你还可以向join传入一组DataFrame，下一节会介绍更为通用的concat函数，也能实现此功能：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">75</span>]: another = pd.DataFrame([[<span class="hljs-number">7.</span>, <span class="hljs-number">8.</span>], [<span class="hljs-number">9.</span>, <span class="hljs-number">10.</span>], [<span class="hljs-number">11.</span>, <span class="hljs-number">12.</span>], [<span class="hljs-number">16.</span>, <span class="hljs-number">17.</span>]],</span><br><span class="line">   ....:                        index=[<span class="hljs-string">'a'</span>, <span class="hljs-string">'c'</span>, <span class="hljs-string">'e'</span>, <span class="hljs-string">'f'</span>],</span><br><span class="line">   ....:                        columns=[<span class="hljs-string">'New York'</span>,</span><br><span class="line"><span class="hljs-string">'Oregon'</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">76</span>]: another</span><br><span class="line">Out[<span class="hljs-number">76</span>]: </span><br><span class="line">   New York  Oregon</span><br><span class="line">a       <span class="hljs-number">7.0</span>     <span class="hljs-number">8.0</span></span><br><span class="line">c       <span class="hljs-number">9.0</span>    <span class="hljs-number">10.0</span></span><br><span class="line">e      <span class="hljs-number">11.0</span>    <span class="hljs-number">12.0</span></span><br><span class="line">f      <span class="hljs-number">16.0</span>    <span class="hljs-number">17.0</span></span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">77</span>]: left2.join([right2, another])</span><br><span class="line">Out[<span class="hljs-number">77</span>]: </span><br><span class="line">   Ohio  Nevada  Missouri  Alabama  New York  Oregon</span><br><span class="line">a   <span class="hljs-number">1.0</span>     <span class="hljs-number">2.0</span>       NaN      NaN       <span class="hljs-number">7.0</span>     <span class="hljs-number">8.0</span></span><br><span class="line">c   <span class="hljs-number">3.0</span>     <span class="hljs-number">4.0</span>       <span class="hljs-number">9.0</span>     <span class="hljs-number">10.0</span>       <span class="hljs-number">9.0</span>    <span class="hljs-number">10.0</span></span><br><span class="line">e   <span class="hljs-number">5.0</span>     <span class="hljs-number">6.0</span>      <span class="hljs-number">13.0</span>     <span class="hljs-number">14.0</span>      <span class="hljs-number">11.0</span>    <span class="hljs-number">12.0</span></span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">78</span>]: left2.join([right2, another], how=<span class="hljs-string">'outer'</span>)</span><br><span class="line">Out[<span class="hljs-number">78</span>]: </span><br><span class="line">   Ohio  Nevada  Missouri  Alabama  New York  Oregon</span><br><span class="line">a   <span class="hljs-number">1.0</span>     <span class="hljs-number">2.0</span>       NaN      NaN       <span class="hljs-number">7.0</span>     <span class="hljs-number">8.0</span></span><br><span class="line">b   NaN     NaN       <span class="hljs-number">7.0</span>      <span class="hljs-number">8.0</span>       NaN     NaN</span><br><span class="line">c   <span class="hljs-number">3.0</span>     <span class="hljs-number">4.0</span>       <span class="hljs-number">9.0</span>     <span class="hljs-number">10.0</span>       <span class="hljs-number">9.0</span>    <span class="hljs-number">10.0</span></span><br><span class="line">d   NaN     NaN      <span class="hljs-number">11.0</span>     <span class="hljs-number">12.0</span>       NaN     NaN</span><br><span class="line">e   <span class="hljs-number">5.0</span>     <span class="hljs-number">6.0</span>      <span class="hljs-number">13.0</span>     <span class="hljs-number">14.0</span>      <span class="hljs-number">11.0</span>    <span class="hljs-number">12.0</span></span><br><span class="line">f   NaN     NaN       NaN      NaN      <span class="hljs-number">16.0</span>    <span class="hljs-number">17.0</span></span><br></pre></td></tr></table></figure>

<h2 id="轴向连接"><a href="#轴向连接" class="headerlink" title="轴向连接"></a>轴向连接</h2><p>另一种数据合并运算也被称作连接（concatenation）、绑定（binding）或堆叠（stacking）。NumPy的concatenation函数可以用NumPy数组来做：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">79</span>]: arr = np.arange(<span class="hljs-number">12</span>).reshape((<span class="hljs-number">3</span>, <span class="hljs-number">4</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">80</span>]: arr</span><br><span class="line">Out[<span class="hljs-number">80</span>]: </span><br><span class="line">array([[ <span class="hljs-number">0</span>,  <span class="hljs-number">1</span>,  <span class="hljs-number">2</span>,  <span class="hljs-number">3</span>],</span><br><span class="line">       [ <span class="hljs-number">4</span>,  <span class="hljs-number">5</span>,  <span class="hljs-number">6</span>,  <span class="hljs-number">7</span>],</span><br><span class="line">       [ <span class="hljs-number">8</span>,  <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">11</span>]])</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">81</span>]: np.concatenate([arr, arr], axis=<span class="hljs-number">1</span>)</span><br><span class="line">Out[<span class="hljs-number">81</span>]: </span><br><span class="line">array([[ <span class="hljs-number">0</span>,  <span class="hljs-number">1</span>,  <span class="hljs-number">2</span>,  <span class="hljs-number">3</span>,  <span class="hljs-number">0</span>,  <span class="hljs-number">1</span>,  <span class="hljs-number">2</span>,  <span class="hljs-number">3</span>],</span><br><span class="line">       [ <span class="hljs-number">4</span>,  <span class="hljs-number">5</span>,  <span class="hljs-number">6</span>,  <span class="hljs-number">7</span>,  <span class="hljs-number">4</span>,  <span class="hljs-number">5</span>,  <span class="hljs-number">6</span>,  <span class="hljs-number">7</span>],</span><br><span class="line">       [ <span class="hljs-number">8</span>,  <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">11</span>,  <span class="hljs-number">8</span>,  <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">11</span>]])</span><br></pre></td></tr></table></figure>

<p>对于pandas对象（如Series和DataFrame），带有标签的轴使你能够进一步推广数组的连接运算。具体点说，你还需要考虑以下这些东西：</p>
<ul>
<li>如果对象在其它轴上的索引不同，我们应该合并这些轴的不同元素还是只使用交集？</li>
<li>连接的数据集是否需要在结果对象中可识别？</li>
<li>连接轴中保存的数据是否需要保留？许多情况下，DataFrame默认的整数标签最好在连接时删掉。</li>
</ul>
<p>pandas的concat函数提供了一种能够解决这些问题的可靠方式。我将给出一些例子来讲解其使用方式。假设有三个没有重叠索引的Series：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">82</span>]: s1 = pd.Series([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>], index=[<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">83</span>]: s2 = pd.Series([<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>], index=[<span class="hljs-string">'c'</span>, <span class="hljs-string">'d'</span>, <span class="hljs-string">'e'</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">84</span>]: s3 = pd.Series([<span class="hljs-number">5</span>, <span class="hljs-number">6</span>], index=[<span class="hljs-string">'f'</span>, <span class="hljs-string">'g'</span>])</span><br></pre></td></tr></table></figure>

<p>对这些对象调用concat可以将值和索引粘合在一起：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">85</span>]: pd.concat([s1, s2, s3])</span><br><span class="line">Out[<span class="hljs-number">85</span>]: </span><br><span class="line">a    <span class="hljs-number">0</span></span><br><span class="line">b    <span class="hljs-number">1</span></span><br><span class="line">c    <span class="hljs-number">2</span></span><br><span class="line">d    <span class="hljs-number">3</span></span><br><span class="line">e    <span class="hljs-number">4</span></span><br><span class="line">f    <span class="hljs-number">5</span></span><br><span class="line">g    <span class="hljs-number">6</span></span><br><span class="line">dtype: int64</span><br></pre></td></tr></table></figure>

<p>默认情况下，concat是在axis=0上工作的，最终产生一个新的Series。如果传入axis=1，则结果就会变成一个DataFrame（axis=1是列）：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">86</span>]: pd.concat([s1, s2, s3], axis=<span class="hljs-number">1</span>)</span><br><span class="line">Out[<span class="hljs-number">86</span>]: </span><br><span class="line">     <span class="hljs-number">0</span>    <span class="hljs-number">1</span>    <span class="hljs-number">2</span></span><br><span class="line">a  <span class="hljs-number">0.0</span>  NaN  NaN</span><br><span class="line">b  <span class="hljs-number">1.0</span>  NaN  NaN</span><br><span class="line">c  NaN  <span class="hljs-number">2.0</span>  NaN</span><br><span class="line">d  NaN  <span class="hljs-number">3.0</span>  NaN</span><br><span class="line">e  NaN  <span class="hljs-number">4.0</span>  NaN</span><br><span class="line">f  NaN  NaN  <span class="hljs-number">5.0</span></span><br><span class="line">g  NaN  NaN  <span class="hljs-number">6.0</span></span><br></pre></td></tr></table></figure>

<p>这种情况下，另外的轴上没有重叠，从索引的有序并集（外连接）上就可以看出来。传入join=’inner’即可得到它们的交集：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">87</span>]: s4 = pd.concat([s1, s3])</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">88</span>]: s4</span><br><span class="line">Out[<span class="hljs-number">88</span>]: </span><br><span class="line">a    <span class="hljs-number">0</span></span><br><span class="line">b    <span class="hljs-number">1</span></span><br><span class="line">f    <span class="hljs-number">5</span></span><br><span class="line">g    <span class="hljs-number">6</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">89</span>]: pd.concat([s1, s4], axis=<span class="hljs-number">1</span>)</span><br><span class="line">Out[<span class="hljs-number">89</span>]: </span><br><span class="line">     <span class="hljs-number">0</span>  <span class="hljs-number">1</span></span><br><span class="line">a  <span class="hljs-number">0.0</span>  <span class="hljs-number">0</span></span><br><span class="line">b  <span class="hljs-number">1.0</span>  <span class="hljs-number">1</span></span><br><span class="line">f  NaN  <span class="hljs-number">5</span></span><br><span class="line">g  NaN  <span class="hljs-number">6</span></span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">90</span>]: pd.concat([s1, s4], axis=<span class="hljs-number">1</span>, join=<span class="hljs-string">'inner'</span>)</span><br><span class="line">Out[<span class="hljs-number">90</span>]: </span><br><span class="line">   <span class="hljs-number">0</span>  <span class="hljs-number">1</span></span><br><span class="line">a  <span class="hljs-number">0</span>  <span class="hljs-number">0</span></span><br><span class="line">b  <span class="hljs-number">1</span>  <span class="hljs-number">1</span></span><br></pre></td></tr></table></figure>

<p>在这个例子中，f和g标签消失了，是因为使用的是join=’inner’选项。</p>
<p>你可以通过join_axes指定要在其它轴上使用的索引：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">91</span>]: pd.concat([s1, s4], axis=<span class="hljs-number">1</span>, join_axes=[[<span class="hljs-string">'a'</span>, <span class="hljs-string">'c'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'e'</span>]])</span><br><span class="line">Out[<span class="hljs-number">91</span>]: </span><br><span class="line">     <span class="hljs-number">0</span>    <span class="hljs-number">1</span></span><br><span class="line">a  <span class="hljs-number">0.0</span>  <span class="hljs-number">0.0</span></span><br><span class="line">c  NaN  NaN</span><br><span class="line">b  <span class="hljs-number">1.0</span>  <span class="hljs-number">1.0</span></span><br><span class="line">e  NaN  NaN</span><br></pre></td></tr></table></figure>

<p>不过有个问题，参与连接的片段在结果中区分不开。假设你想要在连接轴上创建一个层次化索引。使用keys参数即可达到这个目的：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">92</span>]: result = pd.concat([s1, s1, s3], keys=[<span class="hljs-string">'one'</span>,<span class="hljs-string">'two'</span>, <span class="hljs-string">'three'</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">93</span>]: result</span><br><span class="line">Out[<span class="hljs-number">93</span>]: </span><br><span class="line">one    a    <span class="hljs-number">0</span></span><br><span class="line">       b    <span class="hljs-number">1</span></span><br><span class="line">two    a    <span class="hljs-number">0</span></span><br><span class="line">       b    <span class="hljs-number">1</span></span><br><span class="line">three  f    <span class="hljs-number">5</span></span><br><span class="line">       g    <span class="hljs-number">6</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">94</span>]: result.unstack()</span><br><span class="line">Out[<span class="hljs-number">94</span>]: </span><br><span class="line">         a    b    f    g</span><br><span class="line">one    <span class="hljs-number">0.0</span>  <span class="hljs-number">1.0</span>  NaN  NaN</span><br><span class="line">two    <span class="hljs-number">0.0</span>  <span class="hljs-number">1.0</span>  NaN  NaN</span><br><span class="line">three  NaN  NaN  <span class="hljs-number">5.0</span>  <span class="hljs-number">6.0</span></span><br></pre></td></tr></table></figure>

<p>如果沿着axis=1对Series进行合并，则keys就会成为DataFrame的列头：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">95</span>]: pd.concat([s1, s2, s3], axis=<span class="hljs-number">1</span>, keys=[<span class="hljs-string">'one'</span>,<span class="hljs-string">'two'</span>, <span class="hljs-string">'three'</span>])</span><br><span class="line">Out[<span class="hljs-number">95</span>]: </span><br><span class="line">   one  two  three</span><br><span class="line">a  <span class="hljs-number">0.0</span>  NaN    NaN</span><br><span class="line">b  <span class="hljs-number">1.0</span>  NaN    NaN</span><br><span class="line">c  NaN  <span class="hljs-number">2.0</span>    NaN</span><br><span class="line">d  NaN  <span class="hljs-number">3.0</span>    NaN</span><br><span class="line">e  NaN  <span class="hljs-number">4.0</span>    NaN</span><br><span class="line">f  NaN  NaN    <span class="hljs-number">5.0</span></span><br><span class="line">g  NaN  NaN    <span class="hljs-number">6.0</span></span><br></pre></td></tr></table></figure>

<p>同样的逻辑也适用于DataFrame对象：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">96</span>]: df1 = pd.DataFrame(np.arange(<span class="hljs-number">6</span>).reshape(<span class="hljs-number">3</span>, <span class="hljs-number">2</span>), index=[<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>],</span><br><span class="line">   ....:                    columns=[<span class="hljs-string">'one'</span>, <span class="hljs-string">'two'</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">97</span>]: df2 = pd.DataFrame(<span class="hljs-number">5</span> + np.arange(<span class="hljs-number">4</span>).reshape(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>), index=[<span class="hljs-string">'a'</span>, <span class="hljs-string">'c'</span>],</span><br><span class="line">   ....:                    columns=[<span class="hljs-string">'three'</span>, <span class="hljs-string">'four'</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">98</span>]: df1</span><br><span class="line">Out[<span class="hljs-number">98</span>]: </span><br><span class="line">   one  two</span><br><span class="line">a    <span class="hljs-number">0</span>    <span class="hljs-number">1</span></span><br><span class="line">b    <span class="hljs-number">2</span>    <span class="hljs-number">3</span></span><br><span class="line">c    <span class="hljs-number">4</span>    <span class="hljs-number">5</span></span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">99</span>]: df2</span><br><span class="line">Out[<span class="hljs-number">99</span>]: </span><br><span class="line">   three  four</span><br><span class="line">a      <span class="hljs-number">5</span>     <span class="hljs-number">6</span></span><br><span class="line">c      <span class="hljs-number">7</span>     <span class="hljs-number">8</span></span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">100</span>]: pd.concat([df1, df2], axis=<span class="hljs-number">1</span>, keys=[<span class="hljs-string">'level1'</span>, <span class="hljs-string">'level2'</span>])</span><br><span class="line">Out[<span class="hljs-number">100</span>]: </span><br><span class="line">  level1     level2     </span><br><span class="line">     one two  three four</span><br><span class="line">a      <span class="hljs-number">0</span>   <span class="hljs-number">1</span>    <span class="hljs-number">5.0</span>  <span class="hljs-number">6.0</span></span><br><span class="line">b      <span class="hljs-number">2</span>   <span class="hljs-number">3</span>    NaN  NaN</span><br><span class="line">c      <span class="hljs-number">4</span>   <span class="hljs-number">5</span>    <span class="hljs-number">7.0</span>  <span class="hljs-number">8.0</span></span><br></pre></td></tr></table></figure>

<p>如果传入的不是列表而是一个字典，则字典的键就会被当做keys选项的值：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">101</span>]: pd.concat(&#123;<span class="hljs-string">'level1'</span>: df1, <span class="hljs-string">'level2'</span>: df2&#125;, axis=<span class="hljs-number">1</span>)</span><br><span class="line"></span><br><span class="line">Out[<span class="hljs-number">101</span>]: </span><br><span class="line">  level1     level2     </span><br><span class="line">     one two  three four</span><br><span class="line">a      <span class="hljs-number">0</span>   <span class="hljs-number">1</span>    <span class="hljs-number">5.0</span>  <span class="hljs-number">6.0</span></span><br><span class="line">b      <span class="hljs-number">2</span>   <span class="hljs-number">3</span>    NaN  NaN</span><br><span class="line">c      <span class="hljs-number">4</span>   <span class="hljs-number">5</span>    <span class="hljs-number">7.0</span>  <span class="hljs-number">8.0</span></span><br></pre></td></tr></table></figure>

<p>此外还有两个用于管理层次化索引创建方式的参数（参见表8-3）。举个例子，我们可以用names参数命名创建的轴级别：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">102</span>]: pd.concat([df1, df2], axis=<span class="hljs-number">1</span>, keys=[<span class="hljs-string">'level1'</span>, <span class="hljs-string">'level2'</span>],</span><br><span class="line">   .....:           names=[<span class="hljs-string">'upper'</span>, <span class="hljs-string">'lower'</span>])</span><br><span class="line">Out[<span class="hljs-number">102</span>]: </span><br><span class="line">upper level1     level2     </span><br><span class="line">lower    one two  three four</span><br><span class="line">a          <span class="hljs-number">0</span>   <span class="hljs-number">1</span>    <span class="hljs-number">5.0</span>  <span class="hljs-number">6.0</span></span><br><span class="line">b          <span class="hljs-number">2</span>   <span class="hljs-number">3</span>    NaN  NaN</span><br><span class="line">c          <span class="hljs-number">4</span>   <span class="hljs-number">5</span>    <span class="hljs-number">7.0</span>  <span class="hljs-number">8.0</span></span><br></pre></td></tr></table></figure>

<p>最后一个关于DataFrame的问题是，DataFrame的行索引不包含任何相关数据：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">103</span>]: df1 = pd.DataFrame(np.random.randn(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>), columns=[<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>, <span class="hljs-string">'d'</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">104</span>]: df2 = pd.DataFrame(np.random.randn(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>), columns=[<span class="hljs-string">'b'</span>, <span class="hljs-string">'d'</span>, <span class="hljs-string">'a'</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">105</span>]: df1</span><br><span class="line">Out[<span class="hljs-number">105</span>]: </span><br><span class="line">          a         b         c         d</span><br><span class="line"><span class="hljs-number">0</span>  <span class="hljs-number">1.246435</span>  <span class="hljs-number">1.007189</span> <span class="hljs-number">-1.296221</span>  <span class="hljs-number">0.274992</span></span><br><span class="line"><span class="hljs-number">1</span>  <span class="hljs-number">0.228913</span>  <span class="hljs-number">1.352917</span>  <span class="hljs-number">0.886429</span> <span class="hljs-number">-2.001637</span></span><br><span class="line"><span class="hljs-number">2</span> <span class="hljs-number">-0.371843</span>  <span class="hljs-number">1.669025</span> <span class="hljs-number">-0.438570</span> <span class="hljs-number">-0.539741</span></span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">106</span>]: df2</span><br><span class="line">Out[<span class="hljs-number">106</span>]: </span><br><span class="line">          b         d         a</span><br><span class="line"><span class="hljs-number">0</span>  <span class="hljs-number">0.476985</span>  <span class="hljs-number">3.248944</span> <span class="hljs-number">-1.021228</span></span><br><span class="line"><span class="hljs-number">1</span> <span class="hljs-number">-0.577087</span>  <span class="hljs-number">0.124121</span>  <span class="hljs-number">0.302614</span></span><br></pre></td></tr></table></figure>

<p>在这种情况下，传入ignore_index=True即可：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">107</span>]: pd.concat([df1, df2], ignore_index=<span class="hljs-literal">True</span>)</span><br><span class="line">Out[<span class="hljs-number">107</span>]: </span><br><span class="line">          a         b         c         d</span><br><span class="line"><span class="hljs-number">0</span>  <span class="hljs-number">1.246435</span>  <span class="hljs-number">1.007189</span> <span class="hljs-number">-1.296221</span>  <span class="hljs-number">0.274992</span></span><br><span class="line"><span class="hljs-number">1</span>  <span class="hljs-number">0.228913</span>  <span class="hljs-number">1.352917</span>  <span class="hljs-number">0.886429</span> <span class="hljs-number">-2.001637</span></span><br><span class="line"><span class="hljs-number">2</span> <span class="hljs-number">-0.371843</span>  <span class="hljs-number">1.669025</span> <span class="hljs-number">-0.438570</span> <span class="hljs-number">-0.539741</span></span><br><span class="line"><span class="hljs-number">3</span> <span class="hljs-number">-1.021228</span>  <span class="hljs-number">0.476985</span>       NaN  <span class="hljs-number">3.248944</span></span><br><span class="line"><span class="hljs-number">4</span>  <span class="hljs-number">0.302614</span> <span class="hljs-number">-0.577087</span>       NaN  <span class="hljs-number">0.124121</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/blog/7178691-339436563b519415.webp" alt="img"></p>
<p>表8-3 concat函数的参数</p>
<h2 id="合并重叠数据"><a href="#合并重叠数据" class="headerlink" title="合并重叠数据"></a>合并重叠数据</h2><p>还有一种数据组合问题不能用简单的合并（merge）或连接（concatenation）运算来处理。比如说，你可能有索引全部或部分重叠的两个数据集。举个有启发性的例子，我们使用NumPy的where函数，它表示一种等价于面向数组的if-else：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">108</span>]: a = pd.Series([np.nan, <span class="hljs-number">2.5</span>, np.nan, <span class="hljs-number">3.5</span>, <span class="hljs-number">4.5</span>, np.nan],</span><br><span class="line">   .....:               index=[<span class="hljs-string">'f'</span>, <span class="hljs-string">'e'</span>, <span class="hljs-string">'d'</span>, <span class="hljs-string">'c'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'a'</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">109</span>]: b = pd.Series(np.arange(len(a), dtype=np.float64),</span><br><span class="line">   .....:               index=[<span class="hljs-string">'f'</span>, <span class="hljs-string">'e'</span>, <span class="hljs-string">'d'</span>, <span class="hljs-string">'c'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'a'</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">110</span>]: b[<span class="hljs-number">-1</span>] = np.nan</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">111</span>]: a</span><br><span class="line">Out[<span class="hljs-number">111</span>]: </span><br><span class="line">f    NaN</span><br><span class="line">e    <span class="hljs-number">2.5</span></span><br><span class="line">d    NaN</span><br><span class="line">c    <span class="hljs-number">3.5</span></span><br><span class="line">b    <span class="hljs-number">4.5</span></span><br><span class="line">a    NaN</span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">112</span>]: b</span><br><span class="line">Out[<span class="hljs-number">112</span>]: </span><br><span class="line">f    <span class="hljs-number">0.0</span></span><br><span class="line">e    <span class="hljs-number">1.0</span></span><br><span class="line">d    <span class="hljs-number">2.0</span></span><br><span class="line">c    <span class="hljs-number">3.0</span></span><br><span class="line">b    <span class="hljs-number">4.0</span></span><br><span class="line">a    NaN</span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">113</span>]: np.where(pd.isnull(a), b, a)</span><br><span class="line">Out[<span class="hljs-number">113</span>]: array([ <span class="hljs-number">0.</span> ,  <span class="hljs-number">2.5</span>,  <span class="hljs-number">2.</span> ,  <span class="hljs-number">3.5</span>,  <span class="hljs-number">4.5</span>,  nan])</span><br></pre></td></tr></table></figure>

<p>Series有一个combine_first方法，实现的也是一样的功能，还带有pandas的数据对齐：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">114</span>]: b[:<span class="hljs-number">-2</span>].combine_first(a[<span class="hljs-number">2</span>:])</span><br><span class="line">Out[<span class="hljs-number">114</span>]: </span><br><span class="line">a    NaN</span><br><span class="line">b    <span class="hljs-number">4.5</span></span><br><span class="line">c    <span class="hljs-number">3.0</span></span><br><span class="line">d    <span class="hljs-number">2.0</span></span><br><span class="line">e    <span class="hljs-number">1.0</span></span><br><span class="line">f    <span class="hljs-number">0.0</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>

<p>对于DataFrame，combine_first自然也会在列上做同样的事情，因此你可以将其看做：用传递对象中的数据为调用对象的缺失数据“打补丁”：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">115</span>]: df1 = pd.DataFrame(&#123;<span class="hljs-string">'a'</span>: [<span class="hljs-number">1.</span>, np.nan, <span class="hljs-number">5.</span>, np.nan],</span><br><span class="line">   .....:                     <span class="hljs-string">'b'</span>: [np.nan, <span class="hljs-number">2.</span>, np.nan, <span class="hljs-number">6.</span>],</span><br><span class="line">   .....:                     <span class="hljs-string">'c'</span>: range(<span class="hljs-number">2</span>, <span class="hljs-number">18</span>, <span class="hljs-number">4</span>)&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">116</span>]: df2 = pd.DataFrame(&#123;<span class="hljs-string">'a'</span>: [<span class="hljs-number">5.</span>, <span class="hljs-number">4.</span>, np.nan, <span class="hljs-number">3.</span>, <span class="hljs-number">7.</span>],</span><br><span class="line">   .....:                     <span class="hljs-string">'b'</span>: [np.nan, <span class="hljs-number">3.</span>, <span class="hljs-number">4.</span>, <span class="hljs-number">6.</span>, <span class="hljs-number">8.</span>]&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">117</span>]: df1</span><br><span class="line">Out[<span class="hljs-number">117</span>]: </span><br><span class="line">     a    b   c</span><br><span class="line"><span class="hljs-number">0</span>  <span class="hljs-number">1.0</span>  NaN   <span class="hljs-number">2</span></span><br><span class="line"><span class="hljs-number">1</span>  NaN  <span class="hljs-number">2.0</span>   <span class="hljs-number">6</span></span><br><span class="line"><span class="hljs-number">2</span>  <span class="hljs-number">5.0</span>  NaN  <span class="hljs-number">10</span></span><br><span class="line"><span class="hljs-number">3</span>  NaN  <span class="hljs-number">6.0</span>  <span class="hljs-number">14</span></span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">118</span>]: df2</span><br><span class="line">Out[<span class="hljs-number">118</span>]: </span><br><span class="line">     a    b</span><br><span class="line"><span class="hljs-number">0</span>  <span class="hljs-number">5.0</span>  NaN</span><br><span class="line"><span class="hljs-number">1</span>  <span class="hljs-number">4.0</span>  <span class="hljs-number">3.0</span></span><br><span class="line"><span class="hljs-number">2</span>  NaN  <span class="hljs-number">4.0</span></span><br><span class="line"><span class="hljs-number">3</span>  <span class="hljs-number">3.0</span>  <span class="hljs-number">6.0</span></span><br><span class="line"><span class="hljs-number">4</span>  <span class="hljs-number">7.0</span>  <span class="hljs-number">8.0</span></span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">119</span>]: df1.combine_first(df2)</span><br><span class="line">Out[<span class="hljs-number">119</span>]: </span><br><span class="line">     a    b     c</span><br><span class="line"><span class="hljs-number">0</span>  <span class="hljs-number">1.0</span>  NaN   <span class="hljs-number">2.0</span></span><br><span class="line"><span class="hljs-number">1</span>  <span class="hljs-number">4.0</span>  <span class="hljs-number">2.0</span>   <span class="hljs-number">6.0</span></span><br><span class="line"><span class="hljs-number">2</span>  <span class="hljs-number">5.0</span>  <span class="hljs-number">4.0</span>  <span class="hljs-number">10.0</span></span><br><span class="line"><span class="hljs-number">3</span>  <span class="hljs-number">3.0</span>  <span class="hljs-number">6.0</span>  <span class="hljs-number">14.0</span></span><br><span class="line"><span class="hljs-number">4</span>  <span class="hljs-number">7.0</span>  <span class="hljs-number">8.0</span>   NaN</span><br></pre></td></tr></table></figure>

<h1 id="8-3-重塑和轴向旋转"><a href="#8-3-重塑和轴向旋转" class="headerlink" title="8.3 重塑和轴向旋转"></a>8.3 重塑和轴向旋转</h1><p>有许多用于重新排列表格型数据的基础运算。这些函数也称作重塑（reshape）或轴向旋转（pivot）运算。</p>
<h2 id="重塑层次化索引"><a href="#重塑层次化索引" class="headerlink" title="重塑层次化索引"></a>重塑层次化索引</h2><p>层次化索引为DataFrame数据的重排任务提供了一种具有良好一致性的方式。主要功能有二：</p>
<ul>
<li>stack：将数据的列“旋转”为行。</li>
<li>unstack：将数据的行“旋转”为列。</li>
</ul>
<p>我将通过一系列的范例来讲解这些操作。接下来看一个简单的DataFrame，其中的行列索引均为字符串数组：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">120</span>]: data = pd.DataFrame(np.arange(<span class="hljs-number">6</span>).reshape((<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)),</span><br><span class="line">   .....:                     index=pd.Index([<span class="hljs-string">'Ohio'</span>,<span class="hljs-string">'Colorado'</span>], name=<span class="hljs-string">'state'</span>),</span><br><span class="line">   .....:                     columns=pd.Index([<span class="hljs-string">'one'</span>, <span class="hljs-string">'two'</span>, <span class="hljs-string">'three'</span>],</span><br><span class="line">   .....:                     name=<span class="hljs-string">'number'</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">121</span>]: data</span><br><span class="line">Out[<span class="hljs-number">121</span>]: </span><br><span class="line">number    one  two  three</span><br><span class="line">state                    </span><br><span class="line">Ohio        <span class="hljs-number">0</span>    <span class="hljs-number">1</span>      <span class="hljs-number">2</span></span><br><span class="line">Colorado    <span class="hljs-number">3</span>    <span class="hljs-number">4</span>      <span class="hljs-number">5</span></span><br></pre></td></tr></table></figure>

<p>对该数据使用stack方法即可将列转换为行，得到一个Series：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">122</span>]: result = data.stack()</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">123</span>]: result</span><br><span class="line">Out[<span class="hljs-number">123</span>]: </span><br><span class="line">state     number</span><br><span class="line">Ohio      one       <span class="hljs-number">0</span></span><br><span class="line">          two       <span class="hljs-number">1</span></span><br><span class="line">          three     <span class="hljs-number">2</span></span><br><span class="line">Colorado  one       <span class="hljs-number">3</span></span><br><span class="line">          two       <span class="hljs-number">4</span></span><br><span class="line">          three     <span class="hljs-number">5</span></span><br><span class="line">dtype: int64</span><br></pre></td></tr></table></figure>

<p>对于一个层次化索引的Series，你可以用unstack将其重排为一个DataFrame：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">124</span>]: result.unstack()</span><br><span class="line">Out[<span class="hljs-number">124</span>]: </span><br><span class="line">number    one  two  three</span><br><span class="line">state                    </span><br><span class="line">Ohio        <span class="hljs-number">0</span>    <span class="hljs-number">1</span>      <span class="hljs-number">2</span></span><br><span class="line">Colorado    <span class="hljs-number">3</span>    <span class="hljs-number">4</span>      <span class="hljs-number">5</span></span><br></pre></td></tr></table></figure>

<p>默认情况下，unstack操作的是最内层（stack也是如此）。传入分层级别的编号或名称即可对其它级别进行unstack操作：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">125</span>]: result.unstack(<span class="hljs-number">0</span>)</span><br><span class="line">Out[<span class="hljs-number">125</span>]: </span><br><span class="line">state   Ohio  Colorado</span><br><span class="line">number                </span><br><span class="line">one        <span class="hljs-number">0</span>         <span class="hljs-number">3</span></span><br><span class="line">two        <span class="hljs-number">1</span>         <span class="hljs-number">4</span></span><br><span class="line">three      <span class="hljs-number">2</span>         <span class="hljs-number">5</span></span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">126</span>]: result.unstack(<span class="hljs-string">'state'</span>)</span><br><span class="line">Out[<span class="hljs-number">126</span>]: </span><br><span class="line">state   Ohio  Colorado</span><br><span class="line">number                </span><br><span class="line">one        <span class="hljs-number">0</span>         <span class="hljs-number">3</span></span><br><span class="line">two        <span class="hljs-number">1</span>         <span class="hljs-number">4</span></span><br><span class="line">three      <span class="hljs-number">2</span>         <span class="hljs-number">5</span></span><br></pre></td></tr></table></figure>

<p>如果不是所有的级别值都能在各分组中找到的话，则unstack操作可能会引入缺失数据：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">127</span>]: s1 = pd.Series([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>], index=[<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>, <span class="hljs-string">'d'</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">128</span>]: s2 = pd.Series([<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>], index=[<span class="hljs-string">'c'</span>, <span class="hljs-string">'d'</span>, <span class="hljs-string">'e'</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">129</span>]: data2 = pd.concat([s1, s2], keys=[<span class="hljs-string">'one'</span>, <span class="hljs-string">'two'</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">130</span>]: data2</span><br><span class="line">Out[<span class="hljs-number">130</span>]: </span><br><span class="line">one  a    <span class="hljs-number">0</span></span><br><span class="line">     b    <span class="hljs-number">1</span></span><br><span class="line">     c    <span class="hljs-number">2</span></span><br><span class="line">     d    <span class="hljs-number">3</span></span><br><span class="line">two  c    <span class="hljs-number">4</span></span><br><span class="line">     d    <span class="hljs-number">5</span></span><br><span class="line">     e    <span class="hljs-number">6</span></span><br><span class="line">dtype: int64</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">131</span>]: data2.unstack()</span><br><span class="line">Out[<span class="hljs-number">131</span>]: </span><br><span class="line">       a    b    c    d    e</span><br><span class="line">one  <span class="hljs-number">0.0</span>  <span class="hljs-number">1.0</span>  <span class="hljs-number">2.0</span>  <span class="hljs-number">3.0</span>  NaN</span><br><span class="line">two  NaN  NaN  <span class="hljs-number">4.0</span>  <span class="hljs-number">5.0</span>  <span class="hljs-number">6.0</span></span><br></pre></td></tr></table></figure>

<p>stack默认会滤除缺失数据，因此该运算是可逆的：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">132</span>]: data2.unstack()</span><br><span class="line">Out[<span class="hljs-number">132</span>]: </span><br><span class="line">       a    b    c    d    e</span><br><span class="line">one  <span class="hljs-number">0.0</span>  <span class="hljs-number">1.0</span>  <span class="hljs-number">2.0</span>  <span class="hljs-number">3.0</span>  NaN</span><br><span class="line">two  NaN  NaN  <span class="hljs-number">4.0</span>  <span class="hljs-number">5.0</span>  <span class="hljs-number">6.0</span></span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">133</span>]: data2.unstack().stack()</span><br><span class="line">Out[<span class="hljs-number">133</span>]: </span><br><span class="line">one  a    <span class="hljs-number">0.0</span></span><br><span class="line">     b    <span class="hljs-number">1.0</span></span><br><span class="line">     c    <span class="hljs-number">2.0</span></span><br><span class="line">     d    <span class="hljs-number">3.0</span></span><br><span class="line">two  c    <span class="hljs-number">4.0</span></span><br><span class="line">     d    <span class="hljs-number">5.0</span></span><br><span class="line">     e    <span class="hljs-number">6.0</span></span><br><span class="line">dtype: float64</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">134</span>]: data2.unstack().stack(dropna=<span class="hljs-literal">False</span>)</span><br><span class="line">Out[<span class="hljs-number">134</span>]: </span><br><span class="line">one  a    <span class="hljs-number">0.0</span></span><br><span class="line">     b    <span class="hljs-number">1.0</span></span><br><span class="line">     c    <span class="hljs-number">2.0</span></span><br><span class="line">     d    <span class="hljs-number">3.0</span></span><br><span class="line">     e    NaN</span><br><span class="line">two  a    NaN</span><br><span class="line">     b    NaN</span><br><span class="line">     c    <span class="hljs-number">4.0</span></span><br><span class="line">     d    <span class="hljs-number">5.0</span></span><br><span class="line">     e    <span class="hljs-number">6.0</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>

<p>在对DataFrame进行unstack操作时，作为旋转轴的级别将会成为结果中的最低级别：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">135</span>]: df = pd.DataFrame(&#123;<span class="hljs-string">'left'</span>: result, <span class="hljs-string">'right'</span>: result + <span class="hljs-number">5</span>&#125;,</span><br><span class="line">   .....:                   columns=pd.Index([<span class="hljs-string">'left'</span>, <span class="hljs-string">'right'</span>], name=<span class="hljs-string">'side'</span>))</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">136</span>]: df</span><br><span class="line">Out[<span class="hljs-number">136</span>]: </span><br><span class="line">side             left  right</span><br><span class="line">state    number             </span><br><span class="line">Ohio     one        <span class="hljs-number">0</span>      <span class="hljs-number">5</span></span><br><span class="line">         two        <span class="hljs-number">1</span>      <span class="hljs-number">6</span></span><br><span class="line">         three      <span class="hljs-number">2</span>      <span class="hljs-number">7</span></span><br><span class="line">Colorado one        <span class="hljs-number">3</span>      <span class="hljs-number">8</span></span><br><span class="line">         two        <span class="hljs-number">4</span>      <span class="hljs-number">9</span></span><br><span class="line">         three      <span class="hljs-number">5</span>     <span class="hljs-number">10</span></span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">137</span>]: df.unstack(<span class="hljs-string">'state'</span>)</span><br><span class="line">Out[<span class="hljs-number">137</span>]: </span><br><span class="line">side   left          right</span><br><span class="line">state  Ohio Colorado  Ohio Colorado</span><br><span class="line">number                             </span><br><span class="line">one       <span class="hljs-number">0</span>        <span class="hljs-number">3</span>     <span class="hljs-number">5</span>        <span class="hljs-number">8</span></span><br><span class="line">two       <span class="hljs-number">1</span>        <span class="hljs-number">4</span>     <span class="hljs-number">6</span>        <span class="hljs-number">9</span></span><br><span class="line">three     <span class="hljs-number">2</span>        <span class="hljs-number">5</span>     <span class="hljs-number">7</span>       <span class="hljs-number">10</span></span><br></pre></td></tr></table></figure>

<p>当调用stack，我们可以指明轴的名字：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">138</span>]: df.unstack(<span class="hljs-string">'state'</span>).stack(<span class="hljs-string">'side'</span>)</span><br><span class="line">Out[<span class="hljs-number">138</span>]: </span><br><span class="line">state         Colorado  Ohio</span><br><span class="line">number side                 </span><br><span class="line">one    left          <span class="hljs-number">3</span>     <span class="hljs-number">0</span></span><br><span class="line">       right         <span class="hljs-number">8</span>     <span class="hljs-number">5</span></span><br><span class="line">two    left          <span class="hljs-number">4</span>     <span class="hljs-number">1</span></span><br><span class="line">       right         <span class="hljs-number">9</span>     <span class="hljs-number">6</span></span><br><span class="line">three  left          <span class="hljs-number">5</span>     <span class="hljs-number">2</span></span><br><span class="line">       right        <span class="hljs-number">10</span>     <span class="hljs-number">7</span></span><br></pre></td></tr></table></figure>

<h2 id="将“长格式”旋转为“宽格式”"><a href="#将“长格式”旋转为“宽格式”" class="headerlink" title="将“长格式”旋转为“宽格式”"></a>将“长格式”旋转为“宽格式”</h2><p>多个时间序列数据通常是以所谓的“长格式”（long）或“堆叠格式”（stacked）存储在数据库和CSV中的。我们先加载一些示例数据，做一些时间序列规整和数据清洗：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">139</span>]: data = pd.read_csv(<span class="hljs-string">'examples/macrodata.csv'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">140</span>]: data.head()</span><br><span class="line">Out[<span class="hljs-number">140</span>]: </span><br><span class="line">     year  quarter   realgdp  realcons  realinv  realgovt  realdpi    cpi  \</span><br><span class="line"><span class="hljs-number">0</span>  <span class="hljs-number">1959.0</span>      <span class="hljs-number">1.0</span>  <span class="hljs-number">2710.349</span>    <span class="hljs-number">1707.4</span>  <span class="hljs-number">286.898</span>   <span class="hljs-number">470.045</span>   <span class="hljs-number">1886.9</span>  <span class="hljs-number">28.98</span>   </span><br><span class="line"><span class="hljs-number">1</span>  <span class="hljs-number">1959.0</span>      <span class="hljs-number">2.0</span>  <span class="hljs-number">2778.801</span>    <span class="hljs-number">1733.7</span>  <span class="hljs-number">310.859</span>   <span class="hljs-number">481.301</span>   <span class="hljs-number">1919.7</span>  <span class="hljs-number">29.15</span>   </span><br><span class="line"><span class="hljs-number">2</span>  <span class="hljs-number">1959.0</span>      <span class="hljs-number">3.0</span>  <span class="hljs-number">2775.488</span>    <span class="hljs-number">1751.8</span>  <span class="hljs-number">289.226</span>   <span class="hljs-number">491.260</span>   <span class="hljs-number">1916.4</span>  <span class="hljs-number">29.35</span>   </span><br><span class="line"><span class="hljs-number">3</span>  <span class="hljs-number">1959.0</span>      <span class="hljs-number">4.0</span>  <span class="hljs-number">2785.204</span>    <span class="hljs-number">1753.7</span>  <span class="hljs-number">299.356</span>   <span class="hljs-number">484.052</span>   <span class="hljs-number">1931.3</span>  <span class="hljs-number">29.37</span>   </span><br><span class="line"><span class="hljs-number">4</span>  <span class="hljs-number">1960.0</span>      <span class="hljs-number">1.0</span>  <span class="hljs-number">2847.699</span>    <span class="hljs-number">1770.5</span>  <span class="hljs-number">331.722</span>   <span class="hljs-number">462.199</span>   <span class="hljs-number">1955.5</span>  <span class="hljs-number">29.54</span>   </span><br><span class="line">      m1  tbilrate  unemp      pop  infl  realint  </span><br><span class="line"><span class="hljs-number">0</span>  <span class="hljs-number">139.7</span>      <span class="hljs-number">2.82</span>    <span class="hljs-number">5.8</span>  <span class="hljs-number">177.146</span>  <span class="hljs-number">0.00</span>     <span class="hljs-number">0.00</span></span><br><span class="line"><span class="hljs-number">1</span>  <span class="hljs-number">141.7</span>      <span class="hljs-number">3.08</span>    <span class="hljs-number">5.1</span>  <span class="hljs-number">177.830</span>  <span class="hljs-number">2.34</span>     <span class="hljs-number">0.74</span>  </span><br><span class="line"><span class="hljs-number">2</span>  <span class="hljs-number">140.5</span>      <span class="hljs-number">3.82</span>    <span class="hljs-number">5.3</span>  <span class="hljs-number">178.657</span>  <span class="hljs-number">2.74</span>     <span class="hljs-number">1.09</span>  </span><br><span class="line"><span class="hljs-number">3</span>  <span class="hljs-number">140.0</span>      <span class="hljs-number">4.33</span>    <span class="hljs-number">5.6</span>  <span class="hljs-number">179.386</span>  <span class="hljs-number">0.27</span>     <span class="hljs-number">4.06</span>  </span><br><span class="line"><span class="hljs-number">4</span>  <span class="hljs-number">139.6</span>      <span class="hljs-number">3.50</span>    <span class="hljs-number">5.2</span>  <span class="hljs-number">180.007</span>  <span class="hljs-number">2.31</span>     <span class="hljs-number">1.19</span>  </span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">141</span>]: periods = pd.PeriodIndex(year=data.year, quarter=data.quarter,</span><br><span class="line">   .....:                          name=<span class="hljs-string">'date'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">142</span>]: columns = pd.Index([<span class="hljs-string">'realgdp'</span>, <span class="hljs-string">'infl'</span>, <span class="hljs-string">'unemp'</span>], name=<span class="hljs-string">'item'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">143</span>]: data = data.reindex(columns=columns)</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">144</span>]: data.index = periods.to_timestamp(<span class="hljs-string">'D'</span>, <span class="hljs-string">'end'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">145</span>]: ldata = data.stack().reset_index().rename(columns=&#123;<span class="hljs-number">0</span>: <span class="hljs-string">'value'</span>&#125;)</span><br></pre></td></tr></table></figure>

<p>这就是多个时间序列（或者其它带有两个或多个键的可观察数据，这里，我们的键是date和item）的长格式。表中的每行代表一次观察。</p>
<p>关系型数据库（如MySQL）中的数据经常都是这样存储的，因为固定架构（即列名和数据类型）有一个好处：随着表中数据的添加，item列中的值的种类能够增加。在前面的例子中，date和item通常就是主键（用关系型数据库的说法），不仅提供了关系完整性，而且提供了更为简单的查询支持。有的情况下，使用这样的数据会很麻烦，你可能会更喜欢DataFrame，不同的item值分别形成一列，date列中的时间戳则用作索引。DataFrame的pivot方法完全可以实现这个转换：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">147</span>]: pivoted = ldata.pivot(<span class="hljs-string">'date'</span>, <span class="hljs-string">'item'</span>, <span class="hljs-string">'value'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">148</span>]: pivoted</span><br><span class="line">Out[<span class="hljs-number">148</span>]: </span><br><span class="line">item        infl    realgdp  unemp</span><br><span class="line">date                              </span><br><span class="line"><span class="hljs-number">1959</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span>  <span class="hljs-number">0.00</span>   <span class="hljs-number">2710.349</span>    <span class="hljs-number">5.8</span></span><br><span class="line"><span class="hljs-number">1959</span><span class="hljs-number">-06</span><span class="hljs-number">-30</span>  <span class="hljs-number">2.34</span>   <span class="hljs-number">2778.801</span>    <span class="hljs-number">5.1</span></span><br><span class="line"><span class="hljs-number">1959</span><span class="hljs-number">-09</span><span class="hljs-number">-30</span>  <span class="hljs-number">2.74</span>   <span class="hljs-number">2775.488</span>    <span class="hljs-number">5.3</span></span><br><span class="line"><span class="hljs-number">1959</span><span class="hljs-number">-12</span><span class="hljs-number">-31</span>  <span class="hljs-number">0.27</span>   <span class="hljs-number">2785.204</span>    <span class="hljs-number">5.6</span></span><br><span class="line"><span class="hljs-number">1960</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span>  <span class="hljs-number">2.31</span>   <span class="hljs-number">2847.699</span>    <span class="hljs-number">5.2</span></span><br><span class="line"><span class="hljs-number">1960</span><span class="hljs-number">-06</span><span class="hljs-number">-30</span>  <span class="hljs-number">0.14</span>   <span class="hljs-number">2834.390</span>    <span class="hljs-number">5.2</span></span><br><span class="line"><span class="hljs-number">1960</span><span class="hljs-number">-09</span><span class="hljs-number">-30</span>  <span class="hljs-number">2.70</span>   <span class="hljs-number">2839.022</span>    <span class="hljs-number">5.6</span></span><br><span class="line"><span class="hljs-number">1960</span><span class="hljs-number">-12</span><span class="hljs-number">-31</span>  <span class="hljs-number">1.21</span>   <span class="hljs-number">2802.616</span>    <span class="hljs-number">6.3</span></span><br><span class="line"><span class="hljs-number">1961</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span> <span class="hljs-number">-0.40</span>   <span class="hljs-number">2819.264</span>    <span class="hljs-number">6.8</span></span><br><span class="line"><span class="hljs-number">1961</span><span class="hljs-number">-06</span><span class="hljs-number">-30</span>  <span class="hljs-number">1.47</span>   <span class="hljs-number">2872.005</span>    <span class="hljs-number">7.0</span></span><br><span class="line"><span class="hljs-meta">... </span>         ...        ...    ...</span><br><span class="line"><span class="hljs-number">2007</span><span class="hljs-number">-06</span><span class="hljs-number">-30</span>  <span class="hljs-number">2.75</span>  <span class="hljs-number">13203.977</span>    <span class="hljs-number">4.5</span></span><br><span class="line"><span class="hljs-number">2007</span><span class="hljs-number">-09</span><span class="hljs-number">-30</span>  <span class="hljs-number">3.45</span>  <span class="hljs-number">13321.109</span>    <span class="hljs-number">4.7</span></span><br><span class="line"><span class="hljs-number">2007</span><span class="hljs-number">-12</span><span class="hljs-number">-31</span>  <span class="hljs-number">6.38</span>  <span class="hljs-number">13391.249</span>    <span class="hljs-number">4.8</span></span><br><span class="line"><span class="hljs-number">2008</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span>  <span class="hljs-number">2.82</span>  <span class="hljs-number">13366.865</span>    <span class="hljs-number">4.9</span></span><br><span class="line"><span class="hljs-number">2008</span><span class="hljs-number">-06</span><span class="hljs-number">-30</span>  <span class="hljs-number">8.53</span>  <span class="hljs-number">13415.266</span>    <span class="hljs-number">5.4</span></span><br><span class="line"><span class="hljs-number">2008</span><span class="hljs-number">-09</span><span class="hljs-number">-30</span> <span class="hljs-number">-3.16</span>  <span class="hljs-number">13324.600</span>    <span class="hljs-number">6.0</span></span><br><span class="line"><span class="hljs-number">2008</span><span class="hljs-number">-12</span><span class="hljs-number">-31</span> <span class="hljs-number">-8.79</span>  <span class="hljs-number">13141.920</span>    <span class="hljs-number">6.9</span></span><br><span class="line"><span class="hljs-number">2009</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span>  <span class="hljs-number">0.94</span>  <span class="hljs-number">12925.410</span>    <span class="hljs-number">8.1</span></span><br><span class="line"><span class="hljs-number">2009</span><span class="hljs-number">-06</span><span class="hljs-number">-30</span>  <span class="hljs-number">3.37</span>  <span class="hljs-number">12901.504</span>    <span class="hljs-number">9.2</span></span><br><span class="line"><span class="hljs-number">2009</span><span class="hljs-number">-09</span><span class="hljs-number">-30</span>  <span class="hljs-number">3.56</span>  <span class="hljs-number">12990.341</span>    <span class="hljs-number">9.6</span></span><br><span class="line">[<span class="hljs-number">203</span> rows x <span class="hljs-number">3</span> columns]</span><br></pre></td></tr></table></figure>

<p>前两个传递的值分别用作行和列索引，最后一个可选值则是用于填充DataFrame的数据列。假设有两个需要同时重塑的数据列：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">149</span>]: ldata[<span class="hljs-string">'value2'</span>] = np.random.randn(len(ldata))</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">150</span>]: ldata[:<span class="hljs-number">10</span>]</span><br><span class="line">Out[<span class="hljs-number">150</span>]: </span><br><span class="line">        date     item     value    value2</span><br><span class="line"><span class="hljs-number">0</span> <span class="hljs-number">1959</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span>  realgdp  <span class="hljs-number">2710.349</span>  <span class="hljs-number">0.523772</span></span><br><span class="line"><span class="hljs-number">1</span> <span class="hljs-number">1959</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span>     infl     <span class="hljs-number">0.000</span>  <span class="hljs-number">0.000940</span></span><br><span class="line"><span class="hljs-number">2</span> <span class="hljs-number">1959</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span>    unemp     <span class="hljs-number">5.800</span>  <span class="hljs-number">1.343810</span></span><br><span class="line"><span class="hljs-number">3</span> <span class="hljs-number">1959</span><span class="hljs-number">-06</span><span class="hljs-number">-30</span>  realgdp  <span class="hljs-number">2778.801</span> <span class="hljs-number">-0.713544</span></span><br><span class="line"><span class="hljs-number">4</span> <span class="hljs-number">1959</span><span class="hljs-number">-06</span><span class="hljs-number">-30</span>     infl     <span class="hljs-number">2.340</span> <span class="hljs-number">-0.831154</span></span><br><span class="line"><span class="hljs-number">5</span> <span class="hljs-number">1959</span><span class="hljs-number">-06</span><span class="hljs-number">-30</span>    unemp     <span class="hljs-number">5.100</span> <span class="hljs-number">-2.370232</span></span><br><span class="line"><span class="hljs-number">6</span> <span class="hljs-number">1959</span><span class="hljs-number">-09</span><span class="hljs-number">-30</span>  realgdp  <span class="hljs-number">2775.488</span> <span class="hljs-number">-1.860761</span></span><br><span class="line"><span class="hljs-number">7</span> <span class="hljs-number">1959</span><span class="hljs-number">-09</span><span class="hljs-number">-30</span>     infl     <span class="hljs-number">2.740</span> <span class="hljs-number">-0.860757</span></span><br><span class="line"><span class="hljs-number">8</span> <span class="hljs-number">1959</span><span class="hljs-number">-09</span><span class="hljs-number">-30</span>    unemp     <span class="hljs-number">5.300</span>  <span class="hljs-number">0.560145</span></span><br><span class="line"><span class="hljs-number">9</span> <span class="hljs-number">1959</span><span class="hljs-number">-12</span><span class="hljs-number">-31</span>  realgdp  <span class="hljs-number">2785.204</span> <span class="hljs-number">-1.265934</span></span><br></pre></td></tr></table></figure>

<p>如果忽略最后一个参数，得到的DataFrame就会带有层次化的列：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">151</span>]: pivoted = ldata.pivot(<span class="hljs-string">'date'</span>, <span class="hljs-string">'item'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">152</span>]: pivoted[:<span class="hljs-number">5</span>]</span><br><span class="line">Out[<span class="hljs-number">152</span>]: </span><br><span class="line">           value                    value2                    </span><br><span class="line">item        infl   realgdp unemp      infl   realgdp     unemp</span><br><span class="line">date                                                          </span><br><span class="line"><span class="hljs-number">1959</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span>  <span class="hljs-number">0.00</span>  <span class="hljs-number">2710.349</span>   <span class="hljs-number">5.8</span>  <span class="hljs-number">0.000940</span>  <span class="hljs-number">0.523772</span>  <span class="hljs-number">1.343810</span></span><br><span class="line"><span class="hljs-number">1959</span><span class="hljs-number">-06</span><span class="hljs-number">-30</span>  <span class="hljs-number">2.34</span>  <span class="hljs-number">2778.801</span>   <span class="hljs-number">5.1</span> <span class="hljs-number">-0.831154</span> <span class="hljs-number">-0.713544</span> <span class="hljs-number">-2.370232</span></span><br><span class="line"><span class="hljs-number">1959</span><span class="hljs-number">-09</span><span class="hljs-number">-30</span>  <span class="hljs-number">2.74</span>  <span class="hljs-number">2775.488</span>   <span class="hljs-number">5.3</span> <span class="hljs-number">-0.860757</span> <span class="hljs-number">-1.860761</span>  <span class="hljs-number">0.560145</span></span><br><span class="line"><span class="hljs-number">1959</span><span class="hljs-number">-12</span><span class="hljs-number">-31</span>  <span class="hljs-number">0.27</span>  <span class="hljs-number">2785.204</span>   <span class="hljs-number">5.6</span>  <span class="hljs-number">0.119827</span> <span class="hljs-number">-1.265934</span> <span class="hljs-number">-1.063512</span></span><br><span class="line"><span class="hljs-number">1960</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span>  <span class="hljs-number">2.31</span>  <span class="hljs-number">2847.699</span>   <span class="hljs-number">5.2</span> <span class="hljs-number">-2.359419</span>  <span class="hljs-number">0.332883</span> <span class="hljs-number">-0.199543</span></span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">153</span>]: pivoted[<span class="hljs-string">'value'</span>][:<span class="hljs-number">5</span>]</span><br><span class="line">Out[<span class="hljs-number">153</span>]: </span><br><span class="line">item        infl   realgdp  unemp</span><br><span class="line">date                             </span><br><span class="line"><span class="hljs-number">1959</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span>  <span class="hljs-number">0.00</span>  <span class="hljs-number">2710.349</span>    <span class="hljs-number">5.8</span></span><br><span class="line"><span class="hljs-number">1959</span><span class="hljs-number">-06</span><span class="hljs-number">-30</span>  <span class="hljs-number">2.34</span>  <span class="hljs-number">2778.801</span>    <span class="hljs-number">5.1</span></span><br><span class="line"><span class="hljs-number">1959</span><span class="hljs-number">-09</span><span class="hljs-number">-30</span>  <span class="hljs-number">2.74</span>  <span class="hljs-number">2775.488</span>    <span class="hljs-number">5.3</span></span><br><span class="line"><span class="hljs-number">1959</span><span class="hljs-number">-12</span><span class="hljs-number">-31</span>  <span class="hljs-number">0.27</span>  <span class="hljs-number">2785.204</span>    <span class="hljs-number">5.6</span></span><br><span class="line"><span class="hljs-number">1960</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span>  <span class="hljs-number">2.31</span>  <span class="hljs-number">2847.699</span>    <span class="hljs-number">5.2</span></span><br></pre></td></tr></table></figure>

<p>注意，pivot其实就是用set_index创建层次化索引，再用unstack重塑：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">154</span>]: unstacked = ldata.set_index([<span class="hljs-string">'date'</span>, <span class="hljs-string">'item'</span>]).unstack(<span class="hljs-string">'item'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">155</span>]: unstacked[:<span class="hljs-number">7</span>]</span><br><span class="line">Out[<span class="hljs-number">155</span>]: </span><br><span class="line">           value                    value2                    </span><br><span class="line">item        infl   realgdp unemp      infl   realgdp     unemp</span><br><span class="line">date                                                          </span><br><span class="line"><span class="hljs-number">1959</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span>  <span class="hljs-number">0.00</span>  <span class="hljs-number">2710.349</span>   <span class="hljs-number">5.8</span>  <span class="hljs-number">0.000940</span>  <span class="hljs-number">0.523772</span>  <span class="hljs-number">1.343810</span></span><br><span class="line"><span class="hljs-number">1959</span><span class="hljs-number">-06</span><span class="hljs-number">-30</span>  <span class="hljs-number">2.34</span>  <span class="hljs-number">2778.801</span>   <span class="hljs-number">5.1</span> <span class="hljs-number">-0.831154</span> <span class="hljs-number">-0.713544</span> <span class="hljs-number">-2.370232</span></span><br><span class="line"><span class="hljs-number">1959</span><span class="hljs-number">-09</span><span class="hljs-number">-30</span>  <span class="hljs-number">2.74</span>  <span class="hljs-number">2775.488</span>   <span class="hljs-number">5.3</span> <span class="hljs-number">-0.860757</span> <span class="hljs-number">-1.860761</span>  <span class="hljs-number">0.560145</span></span><br><span class="line"><span class="hljs-number">1959</span><span class="hljs-number">-12</span><span class="hljs-number">-31</span>  <span class="hljs-number">0.27</span>  <span class="hljs-number">2785.204</span>   <span class="hljs-number">5.6</span>  <span class="hljs-number">0.119827</span> <span class="hljs-number">-1.265934</span> <span class="hljs-number">-1.063512</span></span><br><span class="line"><span class="hljs-number">1960</span><span class="hljs-number">-03</span><span class="hljs-number">-31</span>  <span class="hljs-number">2.31</span>  <span class="hljs-number">2847.699</span>   <span class="hljs-number">5.2</span> <span class="hljs-number">-2.359419</span>  <span class="hljs-number">0.332883</span> <span class="hljs-number">-0.199543</span></span><br><span class="line"><span class="hljs-number">1960</span><span class="hljs-number">-06</span><span class="hljs-number">-30</span>  <span class="hljs-number">0.14</span>  <span class="hljs-number">2834.390</span>   <span class="hljs-number">5.2</span> <span class="hljs-number">-0.970736</span> <span class="hljs-number">-1.541996</span> <span class="hljs-number">-1.307030</span></span><br><span class="line"><span class="hljs-number">1960</span><span class="hljs-number">-09</span><span class="hljs-number">-30</span>  <span class="hljs-number">2.70</span>  <span class="hljs-number">2839.022</span>   <span class="hljs-number">5.6</span>  <span class="hljs-number">0.377984</span>  <span class="hljs-number">0.286350</span> <span class="hljs-number">-0.753887</span></span><br></pre></td></tr></table></figure>

<h2 id="将“宽格式”旋转为“长格式”"><a href="#将“宽格式”旋转为“长格式”" class="headerlink" title="将“宽格式”旋转为“长格式”"></a>将“宽格式”旋转为“长格式”</h2><p>旋转DataFrame的逆运算是pandas.melt。它不是将一列转换到多个新的DataFrame，而是合并多个列成为一个，产生一个比输入长的DataFrame。看一个例子：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">157</span>]: df = pd.DataFrame(&#123;<span class="hljs-string">'key'</span>: [<span class="hljs-string">'foo'</span>, <span class="hljs-string">'bar'</span>, <span class="hljs-string">'baz'</span>],</span><br><span class="line">   .....:                    <span class="hljs-string">'A'</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>],</span><br><span class="line">   .....:                    <span class="hljs-string">'B'</span>: [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>],</span><br><span class="line">   .....:                    <span class="hljs-string">'C'</span>: [<span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>]&#125;)</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">158</span>]: df</span><br><span class="line">Out[<span class="hljs-number">158</span>]: </span><br><span class="line">   A  B  C  key</span><br><span class="line"><span class="hljs-number">0</span>  <span class="hljs-number">1</span>  <span class="hljs-number">4</span>  <span class="hljs-number">7</span>  foo</span><br><span class="line"><span class="hljs-number">1</span>  <span class="hljs-number">2</span>  <span class="hljs-number">5</span>  <span class="hljs-number">8</span>  bar</span><br><span class="line"><span class="hljs-number">2</span>  <span class="hljs-number">3</span>  <span class="hljs-number">6</span>  <span class="hljs-number">9</span>  baz</span><br></pre></td></tr></table></figure>

<p>key列可能是分组指标，其它的列是数据值。当使用pandas.melt，我们必须指明哪些列是分组指标。下面使用key作为唯一的分组指标：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">159</span>]: melted = pd.melt(df, [<span class="hljs-string">'key'</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">160</span>]: melted</span><br><span class="line">Out[<span class="hljs-number">160</span>]: </span><br><span class="line">   key variable  value</span><br><span class="line"><span class="hljs-number">0</span>  foo        A      <span class="hljs-number">1</span></span><br><span class="line"><span class="hljs-number">1</span>  bar        A      <span class="hljs-number">2</span></span><br><span class="line"><span class="hljs-number">2</span>  baz        A      <span class="hljs-number">3</span></span><br><span class="line"><span class="hljs-number">3</span>  foo        B      <span class="hljs-number">4</span></span><br><span class="line"><span class="hljs-number">4</span>  bar        B      <span class="hljs-number">5</span></span><br><span class="line"><span class="hljs-number">5</span>  baz        B      <span class="hljs-number">6</span></span><br><span class="line"><span class="hljs-number">6</span>  foo        C      <span class="hljs-number">7</span></span><br><span class="line"><span class="hljs-number">7</span>  bar        C      <span class="hljs-number">8</span></span><br><span class="line"><span class="hljs-number">8</span>  baz        C      <span class="hljs-number">9</span></span><br></pre></td></tr></table></figure>

<p>使用pivot，可以重塑回原来的样子：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">161</span>]: reshaped = melted.pivot(<span class="hljs-string">'key'</span>, <span class="hljs-string">'variable'</span>, <span class="hljs-string">'value'</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">162</span>]: reshaped</span><br><span class="line">Out[<span class="hljs-number">162</span>]: </span><br><span class="line">variable  A  B  C</span><br><span class="line">key              </span><br><span class="line">bar       <span class="hljs-number">2</span>  <span class="hljs-number">5</span>  <span class="hljs-number">8</span></span><br><span class="line">baz       <span class="hljs-number">3</span>  <span class="hljs-number">6</span>  <span class="hljs-number">9</span></span><br><span class="line">foo       <span class="hljs-number">1</span>  <span class="hljs-number">4</span>  <span class="hljs-number">7</span></span><br></pre></td></tr></table></figure>

<p>因为pivot的结果从列创建了一个索引，用作行标签，我们可以使用reset_index将数据移回列：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">163</span>]: reshaped.reset_index()</span><br><span class="line">Out[<span class="hljs-number">163</span>]: </span><br><span class="line">variable  key  A  B  C</span><br><span class="line"><span class="hljs-number">0</span>         bar  <span class="hljs-number">2</span>  <span class="hljs-number">5</span>  <span class="hljs-number">8</span></span><br><span class="line"><span class="hljs-number">1</span>         baz  <span class="hljs-number">3</span>  <span class="hljs-number">6</span>  <span class="hljs-number">9</span></span><br><span class="line"><span class="hljs-number">2</span>         foo  <span class="hljs-number">1</span>  <span class="hljs-number">4</span>  <span class="hljs-number">7</span></span><br></pre></td></tr></table></figure>

<p>你还可以指定列的子集，作为值的列：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">164</span>]: pd.melt(df, id_vars=[<span class="hljs-string">'key'</span>], value_vars=[<span class="hljs-string">'A'</span>, <span class="hljs-string">'B'</span>])</span><br><span class="line">Out[<span class="hljs-number">164</span>]: </span><br><span class="line">   key variable  value</span><br><span class="line"><span class="hljs-number">0</span>  foo        A      <span class="hljs-number">1</span></span><br><span class="line"><span class="hljs-number">1</span>  bar        A      <span class="hljs-number">2</span></span><br><span class="line"><span class="hljs-number">2</span>  baz        A      <span class="hljs-number">3</span></span><br><span class="line"><span class="hljs-number">3</span>  foo        B      <span class="hljs-number">4</span></span><br><span class="line"><span class="hljs-number">4</span>  bar        B      <span class="hljs-number">5</span></span><br><span class="line"><span class="hljs-number">5</span>  baz        B      <span class="hljs-number">6</span></span><br></pre></td></tr></table></figure>

<p>pandas.melt也可以不用分组指标：</p>
<figure class="highlight python hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="hljs-number">165</span>]: pd.melt(df, value_vars=[<span class="hljs-string">'A'</span>, <span class="hljs-string">'B'</span>, <span class="hljs-string">'C'</span>])</span><br><span class="line">Out[<span class="hljs-number">165</span>]: </span><br><span class="line">  variable  value</span><br><span class="line"><span class="hljs-number">0</span>        A      <span class="hljs-number">1</span></span><br><span class="line"><span class="hljs-number">1</span>        A      <span class="hljs-number">2</span></span><br><span class="line"><span class="hljs-number">2</span>        A      <span class="hljs-number">3</span></span><br><span class="line"><span class="hljs-number">3</span>        B      <span class="hljs-number">4</span></span><br><span class="line"><span class="hljs-number">4</span>        B      <span class="hljs-number">5</span></span><br><span class="line"><span class="hljs-number">5</span>        B      <span class="hljs-number">6</span></span><br><span class="line"><span class="hljs-number">6</span>        C      <span class="hljs-number">7</span></span><br><span class="line"><span class="hljs-number">7</span>        C      <span class="hljs-number">8</span></span><br><span class="line"><span class="hljs-number">8</span>        C      <span class="hljs-number">9</span></span><br><span class="line"></span><br><span class="line">In [<span class="hljs-number">166</span>]: pd.melt(df, value_vars=[<span class="hljs-string">'key'</span>, <span class="hljs-string">'A'</span>, <span class="hljs-string">'B'</span>])</span><br><span class="line">Out[<span class="hljs-number">166</span>]: </span><br><span class="line">  variable value</span><br><span class="line"><span class="hljs-number">0</span>      key   foo</span><br><span class="line"><span class="hljs-number">1</span>      key   bar</span><br><span class="line"><span class="hljs-number">2</span>      key   baz</span><br><span class="line"><span class="hljs-number">3</span>        A     <span class="hljs-number">1</span></span><br><span class="line"><span class="hljs-number">4</span>        A     <span class="hljs-number">2</span></span><br><span class="line"><span class="hljs-number">5</span>        A     <span class="hljs-number">3</span></span><br><span class="line"><span class="hljs-number">6</span>        B     <span class="hljs-number">4</span></span><br><span class="line"><span class="hljs-number">7</span>        B     <span class="hljs-number">5</span></span><br><span class="line"><span class="hljs-number">8</span>        B     <span class="hljs-number">6</span></span><br></pre></td></tr></table></figure>

<h1 id="8-4-总结"><a href="#8-4-总结" class="headerlink" title="8.4 总结"></a>8.4 总结</h1><p>现在你已经掌握了pandas数据导入、清洗、重塑，我们可以进一步学习matplotlib数据可视化。我们在稍后会回到pandas，学习更高级的分析。</p>

        </div>
        
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <span class="is-size-6 has-text-grey has-mr-7">#</span>
                    <a class="has-link-grey -link" href="/tags/pandas/" rel="tag">pandas</a>, <a class="has-link-grey -link" href="/tags/python/" rel="tag">python</a>, <a class="has-link-grey -link" href="/tags/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/" rel="tag">数据分析</a>
                </div>
            </div>
        </div>
        
        
        
        <div class="social-share" data-disabled="diandian, linkedin, douban"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">
<script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3>
        <div class="buttons is-centered">
            
                
<a class="button is-info donate">
    <span class="icon is-small">
        <i class="fab fa-alipay"></i>
    </span>
    <span>支付宝</span>
    <div class="qrcode"><img src="/images/alipay.jpg" alt="支付宝"></div>
</a>

                
                
<a class="button is-success donate">
    <span class="icon is-small">
        <i class="fab fa-weixin"></i>
    </span>
    <span>微信</span>
    <div class="qrcode"><img src="/images/wechat.png" alt="微信"></div>
</a>

                
        </div>
    </div>
</div>



<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/2019/11/05/%E3%80%8A%E5%88%A9%E7%94%A8Python%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%C2%B7%E7%AC%AC2%E7%89%88%E3%80%8B%E7%AC%AC9%E7%AB%A0%20%E7%BB%98%E5%9B%BE%E5%92%8C%E5%8F%AF%E8%A7%86%E5%8C%96/">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item">《利用Python进行数据分析·第2版》第9章 绘图和可视化</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2019/11/05/%E3%80%8A%E5%88%A9%E7%94%A8Python%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%C2%B7%E7%AC%AC2%E7%89%88%E3%80%8B%E7%AC%AC7%E7%AB%A0%20%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E5%92%8C%E5%87%86%E5%A4%87/">
                <span class="level-item">《利用Python进行数据分析·第2版》第7章 数据清洗和准备</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>


</div>
                
    
    <!-- 粘贴的部分 -->
    
                
    
    <!-- 粘贴的部分 -->
                              <!-- 修改，可选保留的栏 -->
    
    
    
    
    <div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right is-sticky">
        
            
<div class="card widget" id="toc">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                目录
            </h3>
            <ul class="menu-list"><li>
        <a class="is-flex" href="#8-1-层次化索引">
        <span class="has-mr-6">1</span>
        <span>8.1 层次化索引</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#重排与分级排序">
        <span class="has-mr-6">1.1</span>
        <span>重排与分级排序</span>
        </a></li><li>
        <a class="is-flex" href="#根据级别汇总统计">
        <span class="has-mr-6">1.2</span>
        <span>根据级别汇总统计</span>
        </a></li><li>
        <a class="is-flex" href="#使用DataFrame的列进行索引">
        <span class="has-mr-6">1.3</span>
        <span>使用DataFrame的列进行索引</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#8-2-合并数据集">
        <span class="has-mr-6">2</span>
        <span>8.2 合并数据集</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#数据库风格的DataFrame合并">
        <span class="has-mr-6">2.1</span>
        <span>数据库风格的DataFrame合并</span>
        </a></li><li>
        <a class="is-flex" href="#索引上的合并">
        <span class="has-mr-6">2.2</span>
        <span>索引上的合并</span>
        </a></li><li>
        <a class="is-flex" href="#轴向连接">
        <span class="has-mr-6">2.3</span>
        <span>轴向连接</span>
        </a></li><li>
        <a class="is-flex" href="#合并重叠数据">
        <span class="has-mr-6">2.4</span>
        <span>合并重叠数据</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#8-3-重塑和轴向旋转">
        <span class="has-mr-6">3</span>
        <span>8.3 重塑和轴向旋转</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#重塑层次化索引">
        <span class="has-mr-6">3.1</span>
        <span>重塑层次化索引</span>
        </a></li><li>
        <a class="is-flex" href="#将“长格式”旋转为“宽格式”">
        <span class="has-mr-6">3.2</span>
        <span>将“长格式”旋转为“宽格式”</span>
        </a></li><li>
        <a class="is-flex" href="#将“宽格式”旋转为“长格式”">
        <span class="has-mr-6">3.3</span>
        <span>将“宽格式”旋转为“长格式”</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#8-4-总结">
        <span class="has-mr-6">4</span>
        <span>8.4 总结</span>
        </a></li></ul>
        </div>
    </div>
</div>

        
            
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-12-19T03:53:12.000Z">2019-12-19</time></div>
                    <a href="/2019/12/19/kpzpw/" class="has-link-black-ter is-size-6">开平招聘网数据爬取及分析</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-11-10T11:48:06.000Z">2019-11-10</time></div>
                    <a href="/2019/11/10/%E7%94%A8python%E5%86%99%E4%BA%86%E4%B8%80%E4%B8%AA%E8%A7%A3%E6%95%B0%E5%AD%97%E5%8D%8E%E5%AE%B9%E9%81%93%E6%B8%B8%E6%88%8F%E7%9A%84%E7%A8%8B%E5%BA%8F/" class="has-link-black-ter is-size-6">用python写了一个解数字华容道游戏的程序</a>
                    <p class="is-size-7 is-uppercase">
                        
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-11-08T01:12:36.000Z">2019-11-08</time></div>
                    <a href="/2019/11/08/%E5%88%86%E4%BA%AB%E4%B8%80%E4%B8%AA%E6%8C%89%E7%85%A7%E6%A8%A1%E6%9D%BF%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E8%87%AA%E5%8A%A8%E6%B1%87%E6%80%BB%E7%BB%9F%E8%AE%A1%E7%9A%84%E8%84%9A%E6%9C%AC/" class="has-link-black-ter is-size-6">分享一个按照模板文件格式自动汇总统计的脚本</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/">数据分析</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-11-05T02:05:39.000Z">2019-11-05</time></div>
                    <a href="/2019/11/05/%E3%80%8A%E5%88%A9%E7%94%A8Python%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%C2%B7%E7%AC%AC2%E7%89%88%E3%80%8B%E9%99%84%E5%BD%95B%20%E6%9B%B4%E5%A4%9A%E5%85%B3%E4%BA%8EIPython%E7%9A%84%E5%86%85%E5%AE%B9%EF%BC%88%E5%AE%8C%EF%BC%89/" class="has-link-black-ter is-size-6">《利用Python进行数据分析·第2版》附录B 更多关于IPython的内容（完）</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/">数据分析</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-11-05T02:04:52.000Z">2019-11-05</time></div>
                    <a href="/2019/11/05/%E3%80%8A%E5%88%A9%E7%94%A8Python%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%C2%B7%E7%AC%AC2%E7%89%88%E3%80%8B%E9%99%84%E5%BD%95A%20NumPy%E9%AB%98%E7%BA%A7%E5%BA%94%E7%94%A8/" class="has-link-black-ter is-size-6">《利用Python进行数据分析·第2版》附录A NumPy高级应用</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/">数据分析</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

        
        
    </div>
    
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/grid.svg" alt="《利用Python进行数据分析·第2版》第8章 数据规整：聚合、合并和重塑" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2019 Lanhoo&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>


    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/" target="_blank" rel="noopener">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="回到顶端" href="javascript:;" target="_blank" rel="noopener">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    <script src="/js/clipboard.js" defer></script>
    

    
    
    


<script src="/js/main.js" defer></script>

<script>
// [].slice.call(document.querySelectorAll('table')).forEach(function(el){
//     var wrapper = document.createElement('div');
//     wrapper.className = 'table-area';
//     el.parentNode.insertBefore(wrapper, el);
//     el.parentNode.removeChild(el);
//     wrapper.appendChild(el);
// })
// 这是给真正的表格添加样式
$(".content > table").wrap("<div class='table-area'></div>");
$("table.dataframe").wrap("<div class='table-area'></div>");
</script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>